{"version":3,"sources":["savory-0.0.1.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length",1,"module","name","context","definition","define","amd","this","selectorEngine","win","window","old","namespaceRegex","nameRegex","addEvent","removeEvent","doc","document","root","documentElement","W3C_MODEL","eventSupport","ONE","slice","Array","prototype","str2arr","d","split","isString","isFunction","standardNativeEvents","w3cNativeEvents","nativeEvents","hash","events","customEvents","isAncestor","element","container","compareDocumentPosition","nodeType","contains","parentNode","check","event","related","relatedTarget","prefix","test","toString","mouseenter","base","condition","mouseleave","mousewheel","navigator","userAgent","Event","commonProps","mouseProps","concat","mouseWheelProps","keyProps","textProps","touchProps","messageProps","stateProps","overOutRegex","typeFixers","reg","fix","newEvent","keyCode","which","type","rightClick","button","pos","x","y","pageX","pageY","clientX","clientY","body","scrollLeft","scrollTop","typeFixerMap","isNative","arguments","ownerDocument","parentWindow","originalEvent","isBean","p","props","fixer","target","srcElement","preventDefault","returnValue","stopPropagation","cancelBubble","stop","stopped","stopImmediatePropagation","isImmediatePropagationStopped","clone","currentTarget","ne","targetElement","RegEntry","wrappedHandler","fn","args","eargs","apply","findTarget","eventElement","__beanDel","ft","handler","original","namespaces","customType","once","removeListener","eventType","inNamespaces","checkNamespaces","j","c","matches","checkElement","checkOriginal","checkHandler","registry","map","forAll","pfx","list","all","charAt","substr","has","get","entries","entry","push","put","key","del","splice","removed","setSelectorEngine","querySelectorAll","rootListener","propertyName","listeners","listener","add","custom","attachEvent","detachEvent","rm","originalFn","orgType","replace","handlers","delegate","selector","array","match","fireListener","evt","createEvent","dispatchEvent","fireEvent","createEventObject","off","typeSpec","k","isTypeStr","indexOf","hasOwnProperty","on","types","first","undefined","delfn","one","fire","names","from","beanDel","bean","remove","noConflict","cleanup","CollectGarbage",2,"factory","rndKey","Date","getTime","onError","requirejs","err","message","emptyFunction","parseURL","href","isWindowLocation","isNotAPI","re","windowLocation","isSupportHistoryAPI","protocol","host","settings","RegExp","current","getElementsByTagName","getAttribute","_pathname","_protocol","_host","_search","anchorElement","result","exec","pathname","search","relative","nohash","_href","_hostname","_port","_hash","_relative","_nohash","_special","storageInitialize","sessionStorage","global","setItem","sessionStorageKey","removeItem","_e_","getItem","cookie","pop","shift","value","state","historyObject","JSON","stringify","stateStorage","parse","eventNamePrefix","redefineProperty","object","prop","descriptor","onWrapped","testOnly","set","isDefinedSetter","isDefinedGetter","configurable","defineProperty","__defineGetter__","__defineSetter__","originalValue","onpopstate","setTimeout","triggerEventsInWindowAttributes","temp","Object","create","getPrototypeOf","bind","constructor","prepareDescriptorsForObject","locationDescriptors","addEventListener","capture","eventsList","removeEventListener","eventObject","onhashchange","len","dispatch","firePopState","initEvent","fireInitialState","isFireInitialState","changeState","url","lastURLValue","lastURL","isUsedHistoryLocationFlag","urlObject","isSupportStateObjectInHistory","onHashChange","fireNow","checkUrlForPopState","oldURLObject","newURLObject","oldURL","newURL","onLoad","noScroll","scrollToAnchorId","locationObject","anchorTarget","nodeName","onAnchorClick","defaultPrevented","expect","isEqualBaseURL","getElementById","id","rect","getBoundingClientRect","scrollTo","top","clientTop","initialize","scripts","src","arg","data","eventsDescriptors","historyDescriptors","history","addEventListenerName","readyState","location","windowHistory","historyPushState","pushState","historyReplaceState","replaceState","createElement","removeEventListenerName","dispatchEventName","basepath","redirect","init","lastTitle","title","fastFixChrome","method","isNeedFix","setup","self","path","assign","reload","hostname","port",3,"getRequest","XMLHttpRequest","ActiveXObject","setDefault","obj","ajax","params","callback","headers","withCredentials","req","onreadystatechange","status","responseText","open","field","setRequestHeader","send",4,"_","savoryConfig","scriptsContainer","autoInit","updateScrollPosition","links","external","identificatorClassName","nav","enabled","activeClassName","error","containerClassname","request","noCache","requiredParam","savory","callbacks","callbacksTypes","merge","./../plugins/utils.js",5,"Parser","Loader","Evented","SavoryError","Interface","load","options","onSuccess","onScriptsLoaded","loader","parser","onPageReady","onLinkClick","onLocationChange","responseData","hide","silent","show","destroy","./../config/savory.js","./../models/Error.js","./../models/Evented.js","./../models/Loader.js","./../models/Parser.js","./../plugins/compat.js","html5-history-api",6,"SError","closeTimer","el","classList","appendChild","clearTimeout","innerHTML","setAttribute","removeChild",7,"applyGlobalMethod","methodName","eventData","proxy","exposedMethods",8,"Link","link","navClassName","_savory","./Evented.js",9,"_url","currentFrameNode","_scriptsProxy","onPageLoad","loadParams","parentContainer","querySelector","paramString","html","normalizedHTML","normalizeHTML","frame","style","display","contentWindow","onload","onFrameLoad","contentDocument","write","close","fdocument","comments","parseComment","comment","nodeValue","findComments","deleteScripts","classname","deleteScript","scriptEl","scriptsEl","addScripts","scriptsHTML","cloneScript","scriptTag","waitForScripts","scriptCount","scriptTags","newScript","className","Function","head","nodes","childNodes","outerHTML","template","start","end","generateID","Math","random","substring","scriptsID","join","nanoajax",10,"dom","forEach","./Link.js",11,"DOMTokenList","classes","defineElementGetter","getter","Element","token","item","index","toggle","oThis","TypeError","aArgs","fToBind","FNOP","fBound",12,"utils","obj1","obj2","scope","arr","node",13,"Savory","config","api","onReady","./controllers/Interface.js","./plugins/utils.js"],"mappings":"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","file":"savory-0.0.1.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n/*!\n  * Bean - copyright (c) Jacob Thornton 2011-2012\n  * https://github.com/fat/bean\n  * MIT license\n  */\n(function (name, context, definition) {\n  if (typeof module != 'undefined' && module.exports) module.exports = definition()\n  else if (typeof define == 'function' && define.amd) define(definition)\n  else context[name] = definition()\n})('bean', this, function (name, context) {\n  name    = name    || 'bean'\n  context = context || this\n\n  var win            = window\n    , old            = context[name]\n    , namespaceRegex = /[^\\.]*(?=\\..*)\\.|.*/\n    , nameRegex      = /\\..*/\n    , addEvent       = 'addEventListener'\n    , removeEvent    = 'removeEventListener'\n    , doc            = document || {}\n    , root           = doc.documentElement || {}\n    , W3C_MODEL      = root[addEvent]\n    , eventSupport   = W3C_MODEL ? addEvent : 'attachEvent'\n    , ONE            = {} // singleton for quick matching making add() do one()\n\n    , slice          = Array.prototype.slice\n    , str2arr        = function (s, d) { return s.split(d || ' ') }\n    , isString       = function (o) { return typeof o == 'string' }\n    , isFunction     = function (o) { return typeof o == 'function' }\n\n      // events that we consider to be 'native', anything not in this list will\n      // be treated as a custom event\n    , standardNativeEvents =\n        'click dblclick mouseup mousedown contextmenu '                  + // mouse buttons\n        'mousewheel mousemultiwheel DOMMouseScroll '                     + // mouse wheel\n        'mouseover mouseout mousemove selectstart selectend '            + // mouse movement\n        'keydown keypress keyup '                                        + // keyboard\n        'orientationchange '                                             + // mobile\n        'focus blur change reset select submit '                         + // form elements\n        'load unload beforeunload resize move DOMContentLoaded '         + // window\n        'readystatechange message '                                      + // window\n        'error abort scroll '                                              // misc\n      // element.fireEvent('onXYZ'... is not forgiving if we try to fire an event\n      // that doesn't actually exist, so make sure we only do these on newer browsers\n    , w3cNativeEvents =\n        'show '                                                          + // mouse buttons\n        'input invalid '                                                 + // form elements\n        'touchstart touchmove touchend touchcancel '                     + // touch\n        'gesturestart gesturechange gestureend '                         + // gesture\n        'textinput '                                                     + // TextEvent\n        'readystatechange pageshow pagehide popstate '                   + // window\n        'hashchange offline online '                                     + // window\n        'afterprint beforeprint '                                        + // printing\n        'dragstart dragenter dragover dragleave drag drop dragend '      + // dnd\n        'loadstart progress suspend emptied stalled loadmetadata '       + // media\n        'loadeddata canplay canplaythrough playing waiting seeking '     + // media\n        'seeked ended durationchange timeupdate play pause ratechange '  + // media\n        'volumechange cuechange '                                        + // media\n        'checking noupdate downloading cached updateready obsolete '       // appcache\n\n      // convert to a hash for quick lookups\n    , nativeEvents = (function (hash, events, i) {\n        for (i = 0; i < events.length; i++) events[i] && (hash[events[i]] = 1)\n        return hash\n      }({}, str2arr(standardNativeEvents + (W3C_MODEL ? w3cNativeEvents : ''))))\n\n      // custom events are events that we *fake*, they are not provided natively but\n      // we can use native events to generate them\n    , customEvents = (function () {\n        var isAncestor = 'compareDocumentPosition' in root\n              ? function (element, container) {\n                  return container.compareDocumentPosition && (container.compareDocumentPosition(element) & 16) === 16\n                }\n              : 'contains' in root\n                ? function (element, container) {\n                    container = container.nodeType === 9 || container === window ? root : container\n                    return container !== element && container.contains(element)\n                  }\n                : function (element, container) {\n                    while (element = element.parentNode) if (element === container) return 1\n                    return 0\n                  }\n          , check = function (event) {\n              var related = event.relatedTarget\n              return !related\n                ? related == null\n                : (related !== this && related.prefix !== 'xul' && !/document/.test(this.toString())\n                    && !isAncestor(related, this))\n            }\n\n        return {\n            mouseenter: { base: 'mouseover', condition: check }\n          , mouseleave: { base: 'mouseout', condition: check }\n          , mousewheel: { base: /Firefox/.test(navigator.userAgent) ? 'DOMMouseScroll' : 'mousewheel' }\n        }\n      }())\n\n      // we provide a consistent Event object across browsers by taking the actual DOM\n      // event object and generating a new one from its properties.\n    , Event = (function () {\n            // a whitelist of properties (for different event types) tells us what to check for and copy\n        var commonProps  = str2arr('altKey attrChange attrName bubbles cancelable ctrlKey currentTarget ' +\n              'detail eventPhase getModifierState isTrusted metaKey relatedNode relatedTarget shiftKey '  +\n              'srcElement target timeStamp type view which propertyName')\n          , mouseProps   = commonProps.concat(str2arr('button buttons clientX clientY dataTransfer '      +\n              'fromElement offsetX offsetY pageX pageY screenX screenY toElement'))\n          , mouseWheelProps = mouseProps.concat(str2arr('wheelDelta wheelDeltaX wheelDeltaY wheelDeltaZ ' +\n              'axis')) // 'axis' is FF specific\n          , keyProps     = commonProps.concat(str2arr('char charCode key keyCode keyIdentifier '          +\n              'keyLocation location'))\n          , textProps    = commonProps.concat(str2arr('data'))\n          , touchProps   = commonProps.concat(str2arr('touches targetTouches changedTouches scale rotation'))\n          , messageProps = commonProps.concat(str2arr('data origin source'))\n          , stateProps   = commonProps.concat(str2arr('state'))\n          , overOutRegex = /over|out/\n            // some event types need special handling and some need special properties, do that all here\n          , typeFixers   = [\n                { // key events\n                    reg: /key/i\n                  , fix: function (event, newEvent) {\n                      newEvent.keyCode = event.keyCode || event.which\n                      return keyProps\n                    }\n                }\n              , { // mouse events\n                    reg: /click|mouse(?!(.*wheel|scroll))|menu|drag|drop/i\n                  , fix: function (event, newEvent, type) {\n                      newEvent.rightClick = event.which === 3 || event.button === 2\n                      newEvent.pos = { x: 0, y: 0 }\n                      if (event.pageX || event.pageY) {\n                        newEvent.clientX = event.pageX\n                        newEvent.clientY = event.pageY\n                      } else if (event.clientX || event.clientY) {\n                        newEvent.clientX = event.clientX + doc.body.scrollLeft + root.scrollLeft\n                        newEvent.clientY = event.clientY + doc.body.scrollTop + root.scrollTop\n                      }\n                      if (overOutRegex.test(type)) {\n                        newEvent.relatedTarget = event.relatedTarget\n                          || event[(type == 'mouseover' ? 'from' : 'to') + 'Element']\n                      }\n                      return mouseProps\n                    }\n                }\n              , { // mouse wheel events\n                    reg: /mouse.*(wheel|scroll)/i\n                  , fix: function () { return mouseWheelProps }\n                }\n              , { // TextEvent\n                    reg: /^text/i\n                  , fix: function () { return textProps }\n                }\n              , { // touch and gesture events\n                    reg: /^touch|^gesture/i\n                  , fix: function () { return touchProps }\n                }\n              , { // message events\n                    reg: /^message$/i\n                  , fix: function () { return messageProps }\n                }\n              , { // popstate events\n                    reg: /^popstate$/i\n                  , fix: function () { return stateProps }\n                }\n              , { // everything else\n                    reg: /.*/\n                  , fix: function () { return commonProps }\n                }\n            ]\n          , typeFixerMap = {} // used to map event types to fixer functions (above), a basic cache mechanism\n\n          , Event = function (event, element, isNative) {\n              if (!arguments.length) return\n              event = event || ((element.ownerDocument || element.document || element).parentWindow || win).event\n              this.originalEvent = event\n              this.isNative       = isNative\n              this.isBean         = true\n\n              if (!event) return\n\n              var type   = event.type\n                , target = event.target || event.srcElement\n                , i, l, p, props, fixer\n\n              this.target = target && target.nodeType === 3 ? target.parentNode : target\n\n              if (isNative) { // we only need basic augmentation on custom events, the rest expensive & pointless\n                fixer = typeFixerMap[type]\n                if (!fixer) { // haven't encountered this event type before, map a fixer function for it\n                  for (i = 0, l = typeFixers.length; i < l; i++) {\n                    if (typeFixers[i].reg.test(type)) { // guaranteed to match at least one, last is .*\n                      typeFixerMap[type] = fixer = typeFixers[i].fix\n                      break\n                    }\n                  }\n                }\n\n                props = fixer(event, this, type)\n                for (i = props.length; i--;) {\n                  if (!((p = props[i]) in this) && p in event) this[p] = event[p]\n                }\n              }\n            }\n\n        // preventDefault() and stopPropagation() are a consistent interface to those functions\n        // on the DOM, stop() is an alias for both of them together\n        Event.prototype.preventDefault = function () {\n          if (this.originalEvent.preventDefault) this.originalEvent.preventDefault()\n          else this.originalEvent.returnValue = false\n        }\n        Event.prototype.stopPropagation = function () {\n          if (this.originalEvent.stopPropagation) this.originalEvent.stopPropagation()\n          else this.originalEvent.cancelBubble = true\n        }\n        Event.prototype.stop = function () {\n          this.preventDefault()\n          this.stopPropagation()\n          this.stopped = true\n        }\n        // stopImmediatePropagation() has to be handled internally because we manage the event list for\n        // each element\n        // note that originalElement may be a Bean#Event object in some situations\n        Event.prototype.stopImmediatePropagation = function () {\n          if (this.originalEvent.stopImmediatePropagation) this.originalEvent.stopImmediatePropagation()\n          this.isImmediatePropagationStopped = function () { return true }\n        }\n        Event.prototype.isImmediatePropagationStopped = function () {\n          return this.originalEvent.isImmediatePropagationStopped && this.originalEvent.isImmediatePropagationStopped()\n        }\n        Event.prototype.clone = function (currentTarget) {\n          //TODO: this is ripe for optimisation, new events are *expensive*\n          // improving this will speed up delegated events\n          var ne = new Event(this, this.element, this.isNative)\n          ne.currentTarget = currentTarget\n          return ne\n        }\n\n        return Event\n      }())\n\n      // if we're in old IE we can't do onpropertychange on doc or win so we use doc.documentElement for both\n    , targetElement = function (element, isNative) {\n        return !W3C_MODEL && !isNative && (element === doc || element === win) ? root : element\n      }\n\n      /**\n        * Bean maintains an internal registry for event listeners. We don't touch elements, objects\n        * or functions to identify them, instead we store everything in the registry.\n        * Each event listener has a RegEntry object, we have one 'registry' for the whole instance.\n        */\n    , RegEntry = (function () {\n        // each handler is wrapped so we can handle delegation and custom events\n        var wrappedHandler = function (element, fn, condition, args) {\n            var call = function (event, eargs) {\n                  return fn.apply(element, args ? slice.call(eargs, event ? 0 : 1).concat(args) : eargs)\n                }\n              , findTarget = function (event, eventElement) {\n                  return fn.__beanDel ? fn.__beanDel.ft(event.target, element) : eventElement\n                }\n              , handler = condition\n                  ? function (event) {\n                      var target = findTarget(event, this) // deleated event\n                      if (condition.apply(target, arguments)) {\n                        if (event) event.currentTarget = target\n                        return call(event, arguments)\n                      }\n                    }\n                  : function (event) {\n                      if (fn.__beanDel) event = event.clone(findTarget(event)) // delegated event, fix the fix\n                      return call(event, arguments)\n                    }\n            handler.__beanDel = fn.__beanDel\n            return handler\n          }\n\n        , RegEntry = function (element, type, handler, original, namespaces, args, root) {\n            var customType     = customEvents[type]\n              , isNative\n\n            if (type == 'unload') {\n              // self clean-up\n              handler = once(removeListener, element, type, handler, original)\n            }\n\n            if (customType) {\n              if (customType.condition) {\n                handler = wrappedHandler(element, handler, customType.condition, args)\n              }\n              type = customType.base || type\n            }\n\n            this.isNative      = isNative = nativeEvents[type] && !!element[eventSupport]\n            this.customType    = !W3C_MODEL && !isNative && type\n            this.element       = element\n            this.type          = type\n            this.original      = original\n            this.namespaces    = namespaces\n            this.eventType     = W3C_MODEL || isNative ? type : 'propertychange'\n            this.target        = targetElement(element, isNative)\n            this[eventSupport] = !!this.target[eventSupport]\n            this.root          = root\n            this.handler       = wrappedHandler(element, handler, null, args)\n          }\n\n        // given a list of namespaces, is our entry in any of them?\n        RegEntry.prototype.inNamespaces = function (checkNamespaces) {\n          var i, j, c = 0\n          if (!checkNamespaces) return true\n          if (!this.namespaces) return false\n          for (i = checkNamespaces.length; i--;) {\n            for (j = this.namespaces.length; j--;) {\n              if (checkNamespaces[i] == this.namespaces[j]) c++\n            }\n          }\n          return checkNamespaces.length === c\n        }\n\n        // match by element, original fn (opt), handler fn (opt)\n        RegEntry.prototype.matches = function (checkElement, checkOriginal, checkHandler) {\n          return this.element === checkElement &&\n            (!checkOriginal || this.original === checkOriginal) &&\n            (!checkHandler || this.handler === checkHandler)\n        }\n\n        return RegEntry\n      }())\n\n    , registry = (function () {\n        // our map stores arrays by event type, just because it's better than storing\n        // everything in a single array.\n        // uses '$' as a prefix for the keys for safety and 'r' as a special prefix for\n        // rootListeners so we can look them up fast\n        var map = {}\n\n          // generic functional search of our registry for matching listeners,\n          // `fn` returns false to break out of the loop\n          , forAll = function (element, type, original, handler, root, fn) {\n              var pfx = root ? 'r' : '$'\n              if (!type || type == '*') {\n                // search the whole registry\n                for (var t in map) {\n                  if (t.charAt(0) == pfx) {\n                    forAll(element, t.substr(1), original, handler, root, fn)\n                  }\n                }\n              } else {\n                var i = 0, l, list = map[pfx + type], all = element == '*'\n                if (!list) return\n                for (l = list.length; i < l; i++) {\n                  if ((all || list[i].matches(element, original, handler)) && !fn(list[i], list, i, type)) return\n                }\n              }\n            }\n\n          , has = function (element, type, original, root) {\n              // we're not using forAll here simply because it's a bit slower and this\n              // needs to be fast\n              var i, list = map[(root ? 'r' : '$') + type]\n              if (list) {\n                for (i = list.length; i--;) {\n                  if (!list[i].root && list[i].matches(element, original, null)) return true\n                }\n              }\n              return false\n            }\n\n          , get = function (element, type, original, root) {\n              var entries = []\n              forAll(element, type, original, null, root, function (entry) {\n                return entries.push(entry)\n              })\n              return entries\n            }\n\n          , put = function (entry) {\n              var has = !entry.root && !this.has(entry.element, entry.type, null, false)\n                , key = (entry.root ? 'r' : '$') + entry.type\n              ;(map[key] || (map[key] = [])).push(entry)\n              return has\n            }\n\n          , del = function (entry) {\n              forAll(entry.element, entry.type, null, entry.handler, entry.root, function (entry, list, i) {\n                list.splice(i, 1)\n                entry.removed = true\n                if (list.length === 0) delete map[(entry.root ? 'r' : '$') + entry.type]\n                return false\n              })\n            }\n\n            // dump all entries, used for onunload\n          , entries = function () {\n              var t, entries = []\n              for (t in map) {\n                if (t.charAt(0) == '$') entries = entries.concat(map[t])\n              }\n              return entries\n            }\n\n        return { has: has, get: get, put: put, del: del, entries: entries }\n      }())\n\n      // we need a selector engine for delegated events, use querySelectorAll if it exists\n      // but for older browsers we need Qwery, Sizzle or similar\n    , selectorEngine\n    , setSelectorEngine = function (e) {\n        if (!arguments.length) {\n          selectorEngine = doc.querySelectorAll\n            ? function (s, r) {\n                return r.querySelectorAll(s)\n              }\n            : function () {\n                throw new Error('Bean: No selector engine installed') // eeek\n              }\n        } else {\n          selectorEngine = e\n        }\n      }\n\n      // we attach this listener to each DOM event that we need to listen to, only once\n      // per event type per DOM element\n    , rootListener = function (event, type) {\n        if (!W3C_MODEL && type && event && event.propertyName != '_on' + type) return\n\n        var listeners = registry.get(this, type || event.type, null, false)\n          , l = listeners.length\n          , i = 0\n\n        event = new Event(event, this, true)\n        if (type) event.type = type\n\n        // iterate through all handlers registered for this type, calling them unless they have\n        // been removed by a previous handler or stopImmediatePropagation() has been called\n        for (; i < l && !event.isImmediatePropagationStopped(); i++) {\n          if (!listeners[i].removed) listeners[i].handler.call(this, event)\n        }\n      }\n\n      // add and remove listeners to DOM elements\n    , listener = W3C_MODEL\n        ? function (element, type, add) {\n            // new browsers\n            element[add ? addEvent : removeEvent](type, rootListener, false)\n          }\n        : function (element, type, add, custom) {\n            // IE8 and below, use attachEvent/detachEvent and we have to piggy-back propertychange events\n            // to simulate event bubbling etc.\n            var entry\n            if (add) {\n              registry.put(entry = new RegEntry(\n                  element\n                , custom || type\n                , function (event) { // handler\n                    rootListener.call(element, event, custom)\n                  }\n                , rootListener\n                , null\n                , null\n                , true // is root\n              ))\n              if (custom && element['_on' + custom] == null) element['_on' + custom] = 0\n              entry.target.attachEvent('on' + entry.eventType, entry.handler)\n            } else {\n              entry = registry.get(element, custom || type, rootListener, true)[0]\n              if (entry) {\n                entry.target.detachEvent('on' + entry.eventType, entry.handler)\n                registry.del(entry)\n              }\n            }\n          }\n\n    , once = function (rm, element, type, fn, originalFn) {\n        // wrap the handler in a handler that does a remove as well\n        return function () {\n          fn.apply(this, arguments)\n          rm(element, type, originalFn)\n        }\n      }\n\n    , removeListener = function (element, orgType, handler, namespaces) {\n        var type     = orgType && orgType.replace(nameRegex, '')\n          , handlers = registry.get(element, type, null, false)\n          , removed  = {}\n          , i, l\n\n        for (i = 0, l = handlers.length; i < l; i++) {\n          if ((!handler || handlers[i].original === handler) && handlers[i].inNamespaces(namespaces)) {\n            // TODO: this is problematic, we have a registry.get() and registry.del() that\n            // both do registry searches so we waste cycles doing this. Needs to be rolled into\n            // a single registry.forAll(fn) that removes while finding, but the catch is that\n            // we'll be splicing the arrays that we're iterating over. Needs extra tests to\n            // make sure we don't screw it up. @rvagg\n            registry.del(handlers[i])\n            if (!removed[handlers[i].eventType] && handlers[i][eventSupport])\n              removed[handlers[i].eventType] = { t: handlers[i].eventType, c: handlers[i].type }\n          }\n        }\n        // check each type/element for removed listeners and remove the rootListener where it's no longer needed\n        for (i in removed) {\n          if (!registry.has(element, removed[i].t, null, false)) {\n            // last listener of this type, remove the rootListener\n            listener(element, removed[i].t, false, removed[i].c)\n          }\n        }\n      }\n\n      // set up a delegate helper using the given selector, wrap the handler function\n    , delegate = function (selector, fn) {\n        //TODO: findTarget (therefore $) is called twice, once for match and once for\n        // setting e.currentTarget, fix this so it's only needed once\n        var findTarget = function (target, root) {\n              var i, array = isString(selector) ? selectorEngine(selector, root) : selector\n              for (; target && target !== root; target = target.parentNode) {\n                for (i = array.length; i--;) {\n                  if (array[i] === target) return target\n                }\n              }\n            }\n          , handler = function (e) {\n              var match = findTarget(e.target, this)\n              if (match) fn.apply(match, arguments)\n            }\n\n        // __beanDel isn't pleasant but it's a private function, not exposed outside of Bean\n        handler.__beanDel = {\n            ft       : findTarget // attach it here for customEvents to use too\n          , selector : selector\n        }\n        return handler\n      }\n\n    , fireListener = W3C_MODEL ? function (isNative, type, element) {\n        // modern browsers, do a proper dispatchEvent()\n        var evt = doc.createEvent(isNative ? 'HTMLEvents' : 'UIEvents')\n        evt[isNative ? 'initEvent' : 'initUIEvent'](type, true, true, win, 1)\n        element.dispatchEvent(evt)\n      } : function (isNative, type, element) {\n        // old browser use onpropertychange, just increment a custom property to trigger the event\n        element = targetElement(element, isNative)\n        isNative ? element.fireEvent('on' + type, doc.createEventObject()) : element['_on' + type]++\n      }\n\n      /**\n        * Public API: off(), on(), add(), (remove()), one(), fire(), clone()\n        */\n\n      /**\n        * off(element[, eventType(s)[, handler ]])\n        */\n    , off = function (element, typeSpec, fn) {\n        var isTypeStr = isString(typeSpec)\n          , k, type, namespaces, i\n\n        if (isTypeStr && typeSpec.indexOf(' ') > 0) {\n          // off(el, 't1 t2 t3', fn) or off(el, 't1 t2 t3')\n          typeSpec = str2arr(typeSpec)\n          for (i = typeSpec.length; i--;)\n            off(element, typeSpec[i], fn)\n          return element\n        }\n\n        type = isTypeStr && typeSpec.replace(nameRegex, '')\n        if (type && customEvents[type]) type = customEvents[type].base\n\n        if (!typeSpec || isTypeStr) {\n          // off(el) or off(el, t1.ns) or off(el, .ns) or off(el, .ns1.ns2.ns3)\n          if (namespaces = isTypeStr && typeSpec.replace(namespaceRegex, '')) namespaces = str2arr(namespaces, '.')\n          removeListener(element, type, fn, namespaces)\n        } else if (isFunction(typeSpec)) {\n          // off(el, fn)\n          removeListener(element, null, typeSpec)\n        } else {\n          // off(el, { t1: fn1, t2, fn2 })\n          for (k in typeSpec) {\n            if (typeSpec.hasOwnProperty(k)) off(element, k, typeSpec[k])\n          }\n        }\n\n        return element\n      }\n\n      /**\n        * on(element, eventType(s)[, selector], handler[, args ])\n        */\n    , on = function(element, events, selector, fn) {\n        var originalFn, type, types, i, args, entry, first\n\n        //TODO: the undefined check means you can't pass an 'args' argument, fix this perhaps?\n        if (selector === undefined && typeof events == 'object') {\n          //TODO: this can't handle delegated events\n          for (type in events) {\n            if (events.hasOwnProperty(type)) {\n              on.call(this, element, type, events[type])\n            }\n          }\n          return\n        }\n\n        if (!isFunction(selector)) {\n          // delegated event\n          originalFn = fn\n          args       = slice.call(arguments, 4)\n          fn         = delegate(selector, originalFn, selectorEngine)\n        } else {\n          args       = slice.call(arguments, 3)\n          fn         = originalFn = selector\n        }\n\n        types = str2arr(events)\n\n        // special case for one(), wrap in a self-removing handler\n        if (this === ONE) {\n          fn = once(off, element, events, fn, originalFn)\n        }\n\n        for (i = types.length; i--;) {\n          // add new handler to the registry and check if it's the first for this element/type\n          first = registry.put(entry = new RegEntry(\n              element\n            , types[i].replace(nameRegex, '') // event type\n            , fn\n            , originalFn\n            , str2arr(types[i].replace(namespaceRegex, ''), '.') // namespaces\n            , args\n            , false // not root\n          ))\n          if (entry[eventSupport] && first) {\n            // first event of this type on this element, add root listener\n            listener(element, entry.eventType, true, entry.customType)\n          }\n        }\n\n        return element\n      }\n\n      /**\n        * add(element[, selector], eventType(s), handler[, args ])\n        *\n        * Deprecated: kept (for now) for backward-compatibility\n        */\n    , add = function (element, events, fn, delfn) {\n        return on.apply(\n            null\n          , !isString(fn)\n              ? slice.call(arguments)\n              : [ element, fn, events, delfn ].concat(arguments.length > 3 ? slice.call(arguments, 5) : [])\n        )\n      }\n\n      /**\n        * one(element, eventType(s)[, selector], handler[, args ])\n        */\n    , one = function () {\n        return on.apply(ONE, arguments)\n      }\n\n      /**\n        * fire(element, eventType(s)[, args ])\n        *\n        * The optional 'args' argument must be an array, if no 'args' argument is provided\n        * then we can use the browser's DOM event system, otherwise we trigger handlers manually\n        */\n    , fire = function (element, type, args) {\n        var types = str2arr(type)\n          , i, j, l, names, handlers\n\n        for (i = types.length; i--;) {\n          type = types[i].replace(nameRegex, '')\n          if (names = types[i].replace(namespaceRegex, '')) names = str2arr(names, '.')\n          if (!names && !args && element[eventSupport]) {\n            fireListener(nativeEvents[type], type, element)\n          } else {\n            // non-native event, either because of a namespace, arguments or a non DOM element\n            // iterate over all listeners and manually 'fire'\n            handlers = registry.get(element, type, null, false)\n            args = [false].concat(args)\n            for (j = 0, l = handlers.length; j < l; j++) {\n              if (handlers[j].inNamespaces(names)) {\n                handlers[j].handler.apply(element, args)\n              }\n            }\n          }\n        }\n        return element\n      }\n\n      /**\n        * clone(dstElement, srcElement[, eventType ])\n        *\n        * TODO: perhaps for consistency we should allow the same flexibility in type specifiers?\n        */\n    , clone = function (element, from, type) {\n        var handlers = registry.get(from, type, null, false)\n          , l = handlers.length\n          , i = 0\n          , args, beanDel\n\n        for (; i < l; i++) {\n          if (handlers[i].original) {\n            args = [ element, handlers[i].type ]\n            if (beanDel = handlers[i].handler.__beanDel) args.push(beanDel.selector)\n            args.push(handlers[i].original)\n            on.apply(null, args)\n          }\n        }\n        return element\n      }\n\n    , bean = {\n          'on'                : on\n        , 'add'               : add\n        , 'one'               : one\n        , 'off'               : off\n        , 'remove'            : off\n        , 'clone'             : clone\n        , 'fire'              : fire\n        , 'Event'             : Event\n        , 'setSelectorEngine' : setSelectorEngine\n        , 'noConflict'        : function () {\n            context[name] = old\n            return this\n          }\n      }\n\n  // for IE, clean up on unload to avoid leaks\n  if (win.attachEvent) {\n    var cleanup = function () {\n      var i, entries = registry.entries()\n      for (i in entries) {\n        if (entries[i].type && entries[i].type !== 'unload') off(entries[i].element, entries[i].type)\n      }\n      win.detachEvent('onunload', cleanup)\n      win.CollectGarbage && win.CollectGarbage()\n    }\n    win.attachEvent('onunload', cleanup)\n  }\n\n  // initialize selector engine to internal default (qSA or throw Error)\n  setSelectorEngine()\n\n  return bean\n});\n\n},{}],2:[function(require,module,exports){\n/*!\n * History API JavaScript Library v4.2.1\n *\n * Support: IE8+, FF3+, Opera 9+, Safari, Chrome and other\n *\n * Copyright 2011-2015, Dmitrii Pakhtinov ( spb.piksel@gmail.com )\n *\n * http://spb-piksel.ru/\n *\n * Dual licensed under the MIT and GPL licenses:\n *   http://www.opensource.org/licenses/mit-license.php\n *   http://www.gnu.org/licenses/gpl.html\n *\n * Update: 2015-05-22 13:02\n */\n(function(factory) {\n    if (typeof define === 'function' && define['amd']) {\n        // https://github.com/devote/HTML5-History-API/issues/73\n        var rndKey = '[history' + (new Date()).getTime() + ']';\n        var onError = requirejs['onError'];\n        factory.toString = function() {\n          return rndKey;\n        };\n        requirejs['onError'] = function(err) {\n          if (err.message.indexOf(rndKey) === -1) {\n            onError.call(requirejs, err);\n          }\n        };\n        define([], factory);\n    }\n    // execute anyway\n    factory();\n})(function() {\n    // Define global variable\n    var global = (typeof window === 'object' ? window : this) || {};\n    // Prevent the code from running if there is no window.history object or library already loaded\n    if (!global.history || \"emulate\" in global.history) return global.history;\n    // symlink to document\n    var document = global.document;\n    // HTML element\n    var documentElement = document.documentElement;\n    // symlink to constructor of Object\n    var Object = global['Object'];\n    // symlink to JSON Object\n    var JSON = global['JSON'];\n    // symlink to instance object of 'Location'\n    var windowLocation = global.location;\n    // symlink to instance object of 'History'\n    var windowHistory = global.history;\n    // new instance of 'History'. The default is a reference to the original object instance\n    var historyObject = windowHistory;\n    // symlink to method 'history.pushState'\n    var historyPushState = windowHistory.pushState;\n    // symlink to method 'history.replaceState'\n    var historyReplaceState = windowHistory.replaceState;\n    // if the browser supports HTML5-History-API\n    var isSupportHistoryAPI = !!historyPushState;\n    // verifies the presence of an object 'state' in interface 'History'\n    var isSupportStateObjectInHistory = 'state' in windowHistory;\n    // symlink to method 'Object.defineProperty'\n    var defineProperty = Object.defineProperty;\n    // new instance of 'Location', for IE8 will use the element HTMLAnchorElement, instead of pure object\n    var locationObject = redefineProperty({}, 't') ? {} : document.createElement('a');\n    // prefix for the names of events\n    var eventNamePrefix = '';\n    // String that will contain the name of the method\n    var addEventListenerName = global.addEventListener ? 'addEventListener' : (eventNamePrefix = 'on') && 'attachEvent';\n    // String that will contain the name of the method\n    var removeEventListenerName = global.removeEventListener ? 'removeEventListener' : 'detachEvent';\n    // String that will contain the name of the method\n    var dispatchEventName = global.dispatchEvent ? 'dispatchEvent' : 'fireEvent';\n    // reference native methods for the events\n    var addEvent = global[addEventListenerName];\n    var removeEvent = global[removeEventListenerName];\n    var dispatch = global[dispatchEventName];\n    // default settings\n    var settings = {\"basepath\": '/', \"redirect\": 0, \"type\": '/', \"init\": 0};\n    // key for the sessionStorage\n    var sessionStorageKey = '__historyAPI__';\n    // Anchor Element for parseURL function\n    var anchorElement = document.createElement('a');\n    // last URL before change to new URL\n    var lastURL = windowLocation.href;\n    // Control URL, need to fix the bug in Opera\n    var checkUrlForPopState = '';\n    // for fix on Safari 8\n    var triggerEventsInWindowAttributes = 1;\n    // trigger event 'onpopstate' on page load\n    var isFireInitialState = false;\n    // if used history.location of other code\n    var isUsedHistoryLocationFlag = 0;\n    // store a list of 'state' objects in the current session\n    var stateStorage = {};\n    // in this object will be stored custom handlers\n    var eventsList = {};\n    // stored last title\n    var lastTitle = document.title;\n\n    /**\n     * Properties that will be replaced in the global\n     * object 'window', to prevent conflicts\n     *\n     * @type {Object}\n     */\n    var eventsDescriptors = {\n        \"onhashchange\": null,\n        \"onpopstate\": null\n    };\n\n    /**\n     * Fix for Chrome in iOS\n     * See https://github.com/devote/HTML5-History-API/issues/29\n     */\n    var fastFixChrome = function(method, args) {\n        var isNeedFix = global.history !== windowHistory;\n        if (isNeedFix) {\n            global.history = windowHistory;\n        }\n        method.apply(windowHistory, args);\n        if (isNeedFix) {\n            global.history = historyObject;\n        }\n    };\n\n    /**\n     * Properties that will be replaced/added to object\n     * 'window.history', includes the object 'history.location',\n     * for a complete the work with the URL address\n     *\n     * @type {Object}\n     */\n    var historyDescriptors = {\n        /**\n         * Setting library initialization\n         *\n         * @param {null|String} [basepath] The base path to the site; defaults to the root \"/\".\n         * @param {null|String} [type] Substitute the string after the anchor; by default \"/\".\n         * @param {null|Boolean} [redirect] Enable link translation.\n         */\n        \"setup\": function(basepath, type, redirect) {\n            settings[\"basepath\"] = ('' + (basepath == null ? settings[\"basepath\"] : basepath))\n                .replace(/(?:^|\\/)[^\\/]*$/, '/');\n            settings[\"type\"] = type == null ? settings[\"type\"] : type;\n            settings[\"redirect\"] = redirect == null ? settings[\"redirect\"] : !!redirect;\n        },\n        /**\n         * @namespace history\n         * @param {String} [type]\n         * @param {String} [basepath]\n         */\n        \"redirect\": function(type, basepath) {\n            historyObject['setup'](basepath, type);\n            basepath = settings[\"basepath\"];\n            if (global.top == global.self) {\n                var relative = parseURL(null, false, true)._relative;\n                var path = windowLocation.pathname + windowLocation.search;\n                if (isSupportHistoryAPI) {\n                    path = path.replace(/([^\\/])$/, '$1/');\n                    if (relative != basepath && (new RegExp(\"^\" + basepath + \"$\", \"i\")).test(path)) {\n                        windowLocation.replace(relative);\n                    }\n                } else if (path != basepath) {\n                    path = path.replace(/([^\\/])\\?/, '$1/?');\n                    if ((new RegExp(\"^\" + basepath, \"i\")).test(path)) {\n                        windowLocation.replace(basepath + '#' + path.\n                            replace(new RegExp(\"^\" + basepath, \"i\"), settings[\"type\"]) + windowLocation.hash);\n                    }\n                }\n            }\n        },\n        /**\n         * The method adds a state object entry\n         * to the history.\n         *\n         * @namespace history\n         * @param {Object} state\n         * @param {string} title\n         * @param {string} [url]\n         */\n        pushState: function(state, title, url) {\n            var t = document.title;\n            if (lastTitle != null) {\n                document.title = lastTitle;\n            }\n            historyPushState && fastFixChrome(historyPushState, arguments);\n            changeState(state, url);\n            document.title = t;\n            lastTitle = title;\n        },\n        /**\n         * The method updates the state object,\n         * title, and optionally the URL of the\n         * current entry in the history.\n         *\n         * @namespace history\n         * @param {Object} state\n         * @param {string} title\n         * @param {string} [url]\n         */\n        replaceState: function(state, title, url) {\n            var t = document.title;\n            if (lastTitle != null) {\n                document.title = lastTitle;\n            }\n            delete stateStorage[windowLocation.href];\n            historyReplaceState && fastFixChrome(historyReplaceState, arguments);\n            changeState(state, url, true);\n            document.title = t;\n            lastTitle = title;\n        },\n        /**\n         * Object 'history.location' is similar to the\n         * object 'window.location', except that in\n         * HTML4 browsers it will behave a bit differently\n         *\n         * @namespace history\n         */\n        \"location\": {\n            set: function(value) {\n                if (isUsedHistoryLocationFlag === 0) isUsedHistoryLocationFlag = 1;\n                global.location = value;\n            },\n            get: function() {\n                if (isUsedHistoryLocationFlag === 0) isUsedHistoryLocationFlag = 1;\n                return isSupportHistoryAPI ? windowLocation : locationObject;\n            }\n        },\n        /**\n         * A state object is an object representing\n         * a user interface state.\n         *\n         * @namespace history\n         */\n        \"state\": {\n            get: function() {\n                return stateStorage[windowLocation.href] || null;\n            }\n        }\n    };\n\n    /**\n     * Properties for object 'history.location'.\n     * Object 'history.location' is similar to the\n     * object 'window.location', except that in\n     * HTML4 browsers it will behave a bit differently\n     *\n     * @type {Object}\n     */\n    var locationDescriptors = {\n        /**\n         * Navigates to the given page.\n         *\n         * @namespace history.location\n         */\n        assign: function(url) {\n            if (('' + url).indexOf('#') === 0) {\n                changeState(null, url);\n            } else {\n                windowLocation.assign(url);\n            }\n        },\n        /**\n         * Reloads the current page.\n         *\n         * @namespace history.location\n         */\n        reload: function() {\n            windowLocation.reload();\n        },\n        /**\n         * Removes the current page from\n         * the session history and navigates\n         * to the given page.\n         *\n         * @namespace history.location\n         */\n        replace: function(url) {\n            if (('' + url).indexOf('#') === 0) {\n                changeState(null, url, true);\n            } else {\n                windowLocation.replace(url);\n            }\n        },\n        /**\n         * Returns the current page's location.\n         *\n         * @namespace history.location\n         */\n        toString: function() {\n            return this.href;\n        },\n        /**\n         * Returns the current page's location.\n         * Can be set, to navigate to another page.\n         *\n         * @namespace history.location\n         */\n        \"href\": {\n            get: function() {\n                return parseURL()._href;\n            }\n        },\n        /**\n         * Returns the current page's protocol.\n         *\n         * @namespace history.location\n         */\n        \"protocol\": null,\n        /**\n         * Returns the current page's host and port number.\n         *\n         * @namespace history.location\n         */\n        \"host\": null,\n        /**\n         * Returns the current page's host.\n         *\n         * @namespace history.location\n         */\n        \"hostname\": null,\n        /**\n         * Returns the current page's port number.\n         *\n         * @namespace history.location\n         */\n        \"port\": null,\n        /**\n         * Returns the current page's path only.\n         *\n         * @namespace history.location\n         */\n        \"pathname\": {\n            get: function() {\n                return parseURL()._pathname;\n            }\n        },\n        /**\n         * Returns the current page's search\n         * string, beginning with the character\n         * '?' and to the symbol '#'\n         *\n         * @namespace history.location\n         */\n        \"search\": {\n            get: function() {\n                return parseURL()._search;\n            }\n        },\n        /**\n         * Returns the current page's hash\n         * string, beginning with the character\n         * '#' and to the end line\n         *\n         * @namespace history.location\n         */\n        \"hash\": {\n            set: function(value) {\n                changeState(null, ('' + value).replace(/^(#|)/, '#'), false, lastURL);\n            },\n            get: function() {\n                return parseURL()._hash;\n            }\n        }\n    };\n\n    /**\n     * Just empty function\n     *\n     * @return void\n     */\n    function emptyFunction() {\n        // dummy\n    }\n\n    /**\n     * Prepares a parts of the current or specified reference for later use in the library\n     *\n     * @param {string} [href]\n     * @param {boolean} [isWindowLocation]\n     * @param {boolean} [isNotAPI]\n     * @return {Object}\n     */\n    function parseURL(href, isWindowLocation, isNotAPI) {\n        var re = /(?:(\\w+\\:))?(?:\\/\\/(?:[^@]*@)?([^\\/:\\?#]+)(?::([0-9]+))?)?([^\\?#]*)(?:(\\?[^#]+)|\\?)?(?:(#.*))?/;\n        if (href != null && href !== '' && !isWindowLocation) {\n            var current = parseURL(),\n                base = document.getElementsByTagName('base')[0];\n            if (!isNotAPI && base && base.getAttribute('href')) {\n              // Fix for IE ignoring relative base tags.\n              // See http://stackoverflow.com/questions/3926197/html-base-tag-and-local-folder-path-with-internet-explorer\n              base.href = base.href;\n              current = parseURL(base.href, null, true);\n            }\n            var _pathname = current._pathname, _protocol = current._protocol;\n            // convert to type of string\n            href = '' + href;\n            // convert relative link to the absolute\n            href = /^(?:\\w+\\:)?\\/\\//.test(href) ? href.indexOf(\"/\") === 0\n                ? _protocol + href : href : _protocol + \"//\" + current._host + (\n                href.indexOf(\"/\") === 0 ? href : href.indexOf(\"?\") === 0\n                    ? _pathname + href : href.indexOf(\"#\") === 0\n                    ? _pathname + current._search + href : _pathname.replace(/[^\\/]+$/g, '') + href\n                );\n        } else {\n            href = isWindowLocation ? href : windowLocation.href;\n            // if current browser not support History-API\n            if (!isSupportHistoryAPI || isNotAPI) {\n                // get hash fragment\n                href = href.replace(/^[^#]*/, '') || \"#\";\n                // form the absolute link from the hash\n                // https://github.com/devote/HTML5-History-API/issues/50\n                href = windowLocation.protocol.replace(/:.*$|$/, ':') + '//' + windowLocation.host + settings['basepath']\n                    + href.replace(new RegExp(\"^#[\\/]?(?:\" + settings[\"type\"] + \")?\"), \"\");\n            }\n        }\n        // that would get rid of the links of the form: /../../\n        anchorElement.href = href;\n        // decompose the link in parts\n        var result = re.exec(anchorElement.href);\n        // host name with the port number\n        var host = result[2] + (result[3] ? ':' + result[3] : '');\n        // folder\n        var pathname = result[4] || '/';\n        // the query string\n        var search = result[5] || '';\n        // hash\n        var hash = result[6] === '#' ? '' : (result[6] || '');\n        // relative link, no protocol, no host\n        var relative = pathname + search + hash;\n        // special links for set to hash-link, if browser not support History API\n        var nohash = pathname.replace(new RegExp(\"^\" + settings[\"basepath\"], \"i\"), settings[\"type\"]) + search;\n        // result\n        return {\n            _href: result[1] + '//' + host + relative,\n            _protocol: result[1],\n            _host: host,\n            _hostname: result[2],\n            _port: result[3] || '',\n            _pathname: pathname,\n            _search: search,\n            _hash: hash,\n            _relative: relative,\n            _nohash: nohash,\n            _special: nohash + hash\n        }\n    }\n\n    /**\n     * Initializing storage for the custom state's object\n     */\n    function storageInitialize() {\n        var sessionStorage;\n        /**\n         * sessionStorage throws error when cookies are disabled\n         * Chrome content settings when running the site in a Facebook IFrame.\n         * see: https://github.com/devote/HTML5-History-API/issues/34\n         * and: http://stackoverflow.com/a/12976988/669360\n         */\n        try {\n            sessionStorage = global['sessionStorage'];\n            sessionStorage.setItem(sessionStorageKey + 't', '1');\n            sessionStorage.removeItem(sessionStorageKey + 't');\n        } catch(_e_) {\n            sessionStorage = {\n                getItem: function(key) {\n                    var cookie = document.cookie.split(key + \"=\");\n                    return cookie.length > 1 && cookie.pop().split(\";\").shift() || 'null';\n                },\n                setItem: function(key, value) {\n                    var state = {};\n                    // insert one current element to cookie\n                    if (state[windowLocation.href] = historyObject.state) {\n                        document.cookie = key + '=' + JSON.stringify(state);\n                    }\n                }\n            }\n        }\n\n        try {\n            // get cache from the storage in browser\n            stateStorage = JSON.parse(sessionStorage.getItem(sessionStorageKey)) || {};\n        } catch(_e_) {\n            stateStorage = {};\n        }\n\n        // hang up the event handler to event unload page\n        addEvent(eventNamePrefix + 'unload', function() {\n            // save current state's object\n            sessionStorage.setItem(sessionStorageKey, JSON.stringify(stateStorage));\n        }, false);\n    }\n\n    /**\n     * This method is implemented to override the built-in(native)\n     * properties in the browser, unfortunately some browsers are\n     * not allowed to override all the properties and even add.\n     * For this reason, this was written by a method that tries to\n     * do everything necessary to get the desired result.\n     *\n     * @param {Object} object The object in which will be overridden/added property\n     * @param {String} prop The property name to be overridden/added\n     * @param {Object} [descriptor] An object containing properties set/get\n     * @param {Function} [onWrapped] The function to be called when the wrapper is created\n     * @return {Object|Boolean} Returns an object on success, otherwise returns false\n     */\n    function redefineProperty(object, prop, descriptor, onWrapped) {\n        var testOnly = 0;\n        // test only if descriptor is undefined\n        if (!descriptor) {\n            descriptor = {set: emptyFunction};\n            testOnly = 1;\n        }\n        // variable will have a value of true the success of attempts to set descriptors\n        var isDefinedSetter = !descriptor.set;\n        var isDefinedGetter = !descriptor.get;\n        // for tests of attempts to set descriptors\n        var test = {configurable: true, set: function() {\n            isDefinedSetter = 1;\n        }, get: function() {\n            isDefinedGetter = 1;\n        }};\n\n        try {\n            // testing for the possibility of overriding/adding properties\n            defineProperty(object, prop, test);\n            // running the test\n            object[prop] = object[prop];\n            // attempt to override property using the standard method\n            defineProperty(object, prop, descriptor);\n        } catch(_e_) {\n        }\n\n        // If the variable 'isDefined' has a false value, it means that need to try other methods\n        if (!isDefinedSetter || !isDefinedGetter) {\n            // try to override/add the property, using deprecated functions\n            if (object.__defineGetter__) {\n                // testing for the possibility of overriding/adding properties\n                object.__defineGetter__(prop, test.get);\n                object.__defineSetter__(prop, test.set);\n                // running the test\n                object[prop] = object[prop];\n                // attempt to override property using the deprecated functions\n                descriptor.get && object.__defineGetter__(prop, descriptor.get);\n                descriptor.set && object.__defineSetter__(prop, descriptor.set);\n            }\n\n            // Browser refused to override the property, using the standard and deprecated methods\n            if (!isDefinedSetter || !isDefinedGetter) {\n                if (testOnly) {\n                    return false;\n                } else if (object === global) {\n                    // try override global properties\n                    try {\n                        // save original value from this property\n                        var originalValue = object[prop];\n                        // set null to built-in(native) property\n                        object[prop] = null;\n                    } catch(_e_) {\n                    }\n                    // This rule for Internet Explorer 8\n                    if ('execScript' in global) {\n                        /**\n                         * to IE8 override the global properties using\n                         * VBScript, declaring it in global scope with\n                         * the same names.\n                         */\n                        global['execScript']('Public ' + prop, 'VBScript');\n                        global['execScript']('var ' + prop + ';', 'JavaScript');\n                    } else {\n                        try {\n                            /**\n                             * This hack allows to override a property\n                             * with the set 'configurable: false', working\n                             * in the hack 'Safari' to 'Mac'\n                             */\n                            defineProperty(object, prop, {value: emptyFunction});\n                        } catch(_e_) {\n                            if (prop === 'onpopstate') {\n                                /**\n                                 * window.onpopstate fires twice in Safari 8.0.\n                                 * Block initial event on window.onpopstate\n                                 * See: https://github.com/devote/HTML5-History-API/issues/69\n                                 */\n                                addEvent('popstate', descriptor = function() {\n                                    removeEvent('popstate', descriptor, false);\n                                    var onpopstate = object.onpopstate;\n                                    // cancel initial event on attribute handler\n                                    object.onpopstate = null;\n                                    setTimeout(function() {\n                                      // restore attribute value after short time\n                                      object.onpopstate = onpopstate;\n                                    }, 1);\n                                }, false);\n                                // cancel trigger events on attributes in object the window\n                                triggerEventsInWindowAttributes = 0;\n                            }\n                        }\n                    }\n                    // set old value to new variable\n                    object[prop] = originalValue;\n\n                } else {\n                    // the last stage of trying to override the property\n                    try {\n                        try {\n                            // wrap the object in a new empty object\n                            var temp = Object.create(object);\n                            defineProperty(Object.getPrototypeOf(temp) === object ? temp : object, prop, descriptor);\n                            for(var key in object) {\n                                // need to bind a function to the original object\n                                if (typeof object[key] === 'function') {\n                                    temp[key] = object[key].bind(object);\n                                }\n                            }\n                            try {\n                                // to run a function that will inform about what the object was to wrapped\n                                onWrapped.call(temp, temp, object);\n                            } catch(_e_) {\n                            }\n                            object = temp;\n                        } catch(_e_) {\n                            // sometimes works override simply by assigning the prototype property of the constructor\n                            defineProperty(object.constructor.prototype, prop, descriptor);\n                        }\n                    } catch(_e_) {\n                        // all methods have failed\n                        return false;\n                    }\n                }\n            }\n        }\n\n        return object;\n    }\n\n    /**\n     * Adds the missing property in descriptor\n     *\n     * @param {Object} object An object that stores values\n     * @param {String} prop Name of the property in the object\n     * @param {Object|null} descriptor Descriptor\n     * @return {Object} Returns the generated descriptor\n     */\n    function prepareDescriptorsForObject(object, prop, descriptor) {\n        descriptor = descriptor || {};\n        // the default for the object 'location' is the standard object 'window.location'\n        object = object === locationDescriptors ? windowLocation : object;\n        // setter for object properties\n        descriptor.set = (descriptor.set || function(value) {\n            object[prop] = value;\n        });\n        // getter for object properties\n        descriptor.get = (descriptor.get || function() {\n            return object[prop];\n        });\n        return descriptor;\n    }\n\n    /**\n     * Wrapper for the methods 'addEventListener/attachEvent' in the context of the 'window'\n     *\n     * @param {String} event The event type for which the user is registering\n     * @param {Function} listener The method to be called when the event occurs.\n     * @param {Boolean} capture If true, capture indicates that the user wishes to initiate capture.\n     * @return void\n     */\n    function addEventListener(event, listener, capture) {\n        if (event in eventsList) {\n            // here stored the event listeners 'popstate/hashchange'\n            eventsList[event].push(listener);\n        } else {\n            // FireFox support non-standart four argument aWantsUntrusted\n            // https://github.com/devote/HTML5-History-API/issues/13\n            if (arguments.length > 3) {\n                addEvent(event, listener, capture, arguments[3]);\n            } else {\n                addEvent(event, listener, capture);\n            }\n        }\n    }\n\n    /**\n     * Wrapper for the methods 'removeEventListener/detachEvent' in the context of the 'window'\n     *\n     * @param {String} event The event type for which the user is registered\n     * @param {Function} listener The parameter indicates the Listener to be removed.\n     * @param {Boolean} capture Was registered as a capturing listener or not.\n     * @return void\n     */\n    function removeEventListener(event, listener, capture) {\n        var list = eventsList[event];\n        if (list) {\n            for(var i = list.length; i--;) {\n                if (list[i] === listener) {\n                    list.splice(i, 1);\n                    break;\n                }\n            }\n        } else {\n            removeEvent(event, listener, capture);\n        }\n    }\n\n    /**\n     * Wrapper for the methods 'dispatchEvent/fireEvent' in the context of the 'window'\n     *\n     * @param {Event|String} event Instance of Event or event type string if 'eventObject' used\n     * @param {*} [eventObject] For Internet Explorer 8 required event object on this argument\n     * @return {Boolean} If 'preventDefault' was called the value is false, else the value is true.\n     */\n    function dispatchEvent(event, eventObject) {\n        var eventType = ('' + (typeof event === \"string\" ? event : event.type)).replace(/^on/, '');\n        var list = eventsList[eventType];\n        if (list) {\n            // need to understand that there is one object of Event\n            eventObject = typeof event === \"string\" ? eventObject : event;\n            if (eventObject.target == null) {\n                // need to override some of the properties of the Event object\n                for(var props = ['target', 'currentTarget', 'srcElement', 'type']; event = props.pop();) {\n                    // use 'redefineProperty' to override the properties\n                    eventObject = redefineProperty(eventObject, event, {\n                        get: event === 'type' ? function() {\n                            return eventType;\n                        } : function() {\n                            return global;\n                        }\n                    });\n                }\n            }\n            if (triggerEventsInWindowAttributes) {\n              // run function defined in the attributes 'onpopstate/onhashchange' in the 'window' context\n              ((eventType === 'popstate' ? global.onpopstate : global.onhashchange)\n                  || emptyFunction).call(global, eventObject);\n            }\n            // run other functions that are in the list of handlers\n            for(var i = 0, len = list.length; i < len; i++) {\n                list[i].call(global, eventObject);\n            }\n            return true;\n        } else {\n            return dispatch(event, eventObject);\n        }\n    }\n\n    /**\n     * dispatch current state event\n     */\n    function firePopState() {\n        var o = document.createEvent ? document.createEvent('Event') : document.createEventObject();\n        if (o.initEvent) {\n            o.initEvent('popstate', false, false);\n        } else {\n            o.type = 'popstate';\n        }\n        o.state = historyObject.state;\n        // send a newly created events to be processed\n        dispatchEvent(o);\n    }\n\n    /**\n     * fire initial state for non-HTML5 browsers\n     */\n    function fireInitialState() {\n        if (isFireInitialState) {\n            isFireInitialState = false;\n            firePopState();\n        }\n    }\n\n    /**\n     * Change the data of the current history for HTML4 browsers\n     *\n     * @param {Object} state\n     * @param {string} [url]\n     * @param {Boolean} [replace]\n     * @param {string} [lastURLValue]\n     * @return void\n     */\n    function changeState(state, url, replace, lastURLValue) {\n        if (!isSupportHistoryAPI) {\n            // if not used implementation history.location\n            if (isUsedHistoryLocationFlag === 0) isUsedHistoryLocationFlag = 2;\n            // normalization url\n            var urlObject = parseURL(url, isUsedHistoryLocationFlag === 2 && ('' + url).indexOf(\"#\") !== -1);\n            // if current url not equal new url\n            if (urlObject._relative !== parseURL()._relative) {\n                // if empty lastURLValue to skip hash change event\n                lastURL = lastURLValue;\n                if (replace) {\n                    // only replace hash, not store to history\n                    windowLocation.replace(\"#\" + urlObject._special);\n                } else {\n                    // change hash and add new record to history\n                    windowLocation.hash = urlObject._special;\n                }\n            }\n        } else {\n            lastURL = windowLocation.href;\n        }\n        if (!isSupportStateObjectInHistory && state) {\n            stateStorage[windowLocation.href] = state;\n        }\n        isFireInitialState = false;\n    }\n\n    /**\n     * Event handler function changes the hash in the address bar\n     *\n     * @param {Event} event\n     * @return void\n     */\n    function onHashChange(event) {\n        // https://github.com/devote/HTML5-History-API/issues/46\n        var fireNow = lastURL;\n        // new value to lastURL\n        lastURL = windowLocation.href;\n        // if not empty fireNow, otherwise skipped the current handler event\n        if (fireNow) {\n            // if checkUrlForPopState equal current url, this means that the event was raised popstate browser\n            if (checkUrlForPopState !== windowLocation.href) {\n                // otherwise,\n                // the browser does not support popstate event or just does not run the event by changing the hash.\n                firePopState();\n            }\n            // current event object\n            event = event || global.event;\n\n            var oldURLObject = parseURL(fireNow, true);\n            var newURLObject = parseURL();\n            // HTML4 browser not support properties oldURL/newURL\n            if (!event.oldURL) {\n                event.oldURL = oldURLObject._href;\n                event.newURL = newURLObject._href;\n            }\n            if (oldURLObject._hash !== newURLObject._hash) {\n                // if current hash not equal previous hash\n                dispatchEvent(event);\n            }\n        }\n    }\n\n    /**\n     * The event handler is fully loaded document\n     *\n     * @param {*} [noScroll]\n     * @return void\n     */\n    function onLoad(noScroll) {\n        // Get rid of the events popstate when the first loading a document in the webkit browsers\n        setTimeout(function() {\n            // hang up the event handler for the built-in popstate event in the browser\n            addEvent('popstate', function(e) {\n                // set the current url, that suppress the creation of the popstate event by changing the hash\n                checkUrlForPopState = windowLocation.href;\n                // for Safari browser in OS Windows not implemented 'state' object in 'History' interface\n                // and not implemented in old HTML4 browsers\n                if (!isSupportStateObjectInHistory) {\n                    e = redefineProperty(e, 'state', {get: function() {\n                        return historyObject.state;\n                    }});\n                }\n                // send events to be processed\n                dispatchEvent(e);\n            }, false);\n        }, 0);\n        // for non-HTML5 browsers\n        if (!isSupportHistoryAPI && noScroll !== true && \"location\" in historyObject) {\n            // scroll window to anchor element\n            scrollToAnchorId(locationObject.hash);\n            // fire initial state for non-HTML5 browser after load page\n            fireInitialState();\n        }\n    }\n\n    /**\n     * Finds the closest ancestor anchor element (including the target itself).\n     *\n     * @param {HTMLElement} target The element to start scanning from.\n     * @return {HTMLElement} An element which is the closest ancestor anchor.\n     */\n    function anchorTarget(target) {\n        while (target) {\n            if (target.nodeName === 'A') return target;\n            target = target.parentNode;\n        }\n    }\n\n    /**\n     * Handles anchor elements with a hash fragment for non-HTML5 browsers\n     *\n     * @param {Event} e\n     */\n    function onAnchorClick(e) {\n        var event = e || global.event;\n        var target = anchorTarget(event.target || event.srcElement);\n        var defaultPrevented = \"defaultPrevented\" in event ? event['defaultPrevented'] : event.returnValue === false;\n        if (target && target.nodeName === \"A\" && !defaultPrevented) {\n            var current = parseURL();\n            var expect = parseURL(target.getAttribute(\"href\", 2));\n            var isEqualBaseURL = current._href.split('#').shift() === expect._href.split('#').shift();\n            if (isEqualBaseURL && expect._hash) {\n                if (current._hash !== expect._hash) {\n                    locationObject.hash = expect._hash;\n                }\n                scrollToAnchorId(expect._hash);\n                if (event.preventDefault) {\n                    event.preventDefault();\n                } else {\n                    event.returnValue = false;\n                }\n            }\n        }\n    }\n\n    /**\n     * Scroll page to current anchor in url-hash\n     *\n     * @param hash\n     */\n    function scrollToAnchorId(hash) {\n        var target = document.getElementById(hash = (hash || '').replace(/^#/, ''));\n        if (target && target.id === hash && target.nodeName === \"A\") {\n            var rect = target.getBoundingClientRect();\n            global.scrollTo((documentElement.scrollLeft || 0), rect.top + (documentElement.scrollTop || 0)\n                - (documentElement.clientTop || 0));\n        }\n    }\n\n    /**\n     * Library initialization\n     *\n     * @return {Boolean} return true if all is well, otherwise return false value\n     */\n    function initialize() {\n        /**\n         * Get custom settings from the query string\n         */\n        var scripts = document.getElementsByTagName('script');\n        var src = (scripts[scripts.length - 1] || {}).src || '';\n        var arg = src.indexOf('?') !== -1 ? src.split('?').pop() : '';\n        arg.replace(/(\\w+)(?:=([^&]*))?/g, function(a, key, value) {\n            settings[key] = (value || '').replace(/^(0|false)$/, '');\n        });\n\n        /**\n         * hang up the event handler to listen to the events hashchange\n         */\n        addEvent(eventNamePrefix + 'hashchange', onHashChange, false);\n\n        // a list of objects with pairs of descriptors/object\n        var data = [locationDescriptors, locationObject, eventsDescriptors, global, historyDescriptors, historyObject];\n\n        // if browser support object 'state' in interface 'History'\n        if (isSupportStateObjectInHistory) {\n            // remove state property from descriptor\n            delete historyDescriptors['state'];\n        }\n\n        // initializing descriptors\n        for(var i = 0; i < data.length; i += 2) {\n            for(var prop in data[i]) {\n                if (data[i].hasOwnProperty(prop)) {\n                    if (typeof data[i][prop] === 'function') {\n                        // If the descriptor is a simple function, simply just assign it an object\n                        data[i + 1][prop] = data[i][prop];\n                    } else {\n                        // prepare the descriptor the required format\n                        var descriptor = prepareDescriptorsForObject(data[i], prop, data[i][prop]);\n                        // try to set the descriptor object\n                        if (!redefineProperty(data[i + 1], prop, descriptor, function(n, o) {\n                            // is satisfied if the failed override property\n                            if (o === historyObject) {\n                                // the problem occurs in Safari on the Mac\n                                global.history = historyObject = data[i + 1] = n;\n                            }\n                        })) {\n                            // if there is no possibility override.\n                            // This browser does not support descriptors, such as IE7\n\n                            // remove previously hung event handlers\n                            removeEvent(eventNamePrefix + 'hashchange', onHashChange, false);\n\n                            // fail to initialize :(\n                            return false;\n                        }\n\n                        // create a repository for custom handlers onpopstate/onhashchange\n                        if (data[i + 1] === global) {\n                            eventsList[prop] = eventsList[prop.substr(2)] = [];\n                        }\n                    }\n                }\n            }\n        }\n\n        // check settings\n        historyObject['setup']();\n\n        // redirect if necessary\n        if (settings['redirect']) {\n            historyObject['redirect']();\n        }\n\n        // initialize\n        if (settings[\"init\"]) {\n            // You agree that you will use window.history.location instead window.location\n            isUsedHistoryLocationFlag = 1;\n        }\n\n        // If browser does not support object 'state' in interface 'History'\n        if (!isSupportStateObjectInHistory && JSON) {\n            storageInitialize();\n        }\n\n        // track clicks on anchors\n        if (!isSupportHistoryAPI) {\n            document[addEventListenerName](eventNamePrefix + \"click\", onAnchorClick, false);\n        }\n\n        if (document.readyState === 'complete') {\n            onLoad(true);\n        } else {\n            if (!isSupportHistoryAPI && parseURL()._relative !== settings[\"basepath\"]) {\n                isFireInitialState = true;\n            }\n            /**\n             * Need to avoid triggering events popstate the initial page load.\n             * Hang handler popstate as will be fully loaded document that\n             * would prevent triggering event onpopstate\n             */\n            addEvent(eventNamePrefix + 'load', onLoad, false);\n        }\n\n        // everything went well\n        return true;\n    }\n\n    /**\n     * Starting the library\n     */\n    if (!initialize()) {\n        // if unable to initialize descriptors\n        // therefore quite old browser and there\n        // is no sense to continue to perform\n        return;\n    }\n\n    /**\n     * If the property history.emulate will be true,\n     * this will be talking about what's going on\n     * emulation capabilities HTML5-History-API.\n     * Otherwise there is no emulation, ie the\n     * built-in browser capabilities.\n     *\n     * @type {boolean}\n     * @const\n     */\n    historyObject['emulate'] = !isSupportHistoryAPI;\n\n    /**\n     * Replace the original methods on the wrapper\n     */\n    global[addEventListenerName] = addEventListener;\n    global[removeEventListenerName] = removeEventListener;\n    global[dispatchEventName] = dispatchEvent;\n\n    return historyObject;\n});\n\n},{}],3:[function(require,module,exports){\n(function (global){\nexports.ajax = function (params, callback) {\n  if (typeof params == 'string') params = {url: params}\n  var headers = params.headers || {}\n    , body = params.body\n    , method = params.method || (body ? 'POST' : 'GET')\n    , withCredentials = params.withCredentials || false\n\n  var req = getRequest()\n\n  req.onreadystatechange = function () {\n    if (req.readyState == 4)\n      callback(req.status, req.responseText, req)\n  }\n\n  if (body) {\n    setDefault(headers, 'X-Requested-With', 'XMLHttpRequest')\n    setDefault(headers, 'Content-Type', 'application/x-www-form-urlencoded')\n  }\n\n  req.open(method, params.url, true)\n\n  // has no effect in IE\n  // has no effect for same-origin requests\n  // has no effect in CORS if user has disabled 3rd party cookies\n  req.withCredentials = withCredentials\n\n  for (var field in headers)\n    req.setRequestHeader(field, headers[field])\n\n  req.send(body)\n}\n\nfunction getRequest() {\n  if (global.XMLHttpRequest)\n    return new global.XMLHttpRequest;\n  else\n    try { return new global.ActiveXObject(\"MSXML2.XMLHTTP.3.0\"); } catch(e) {}\n  throw new Error('no xmlhttp request able to be created')\n}\n\nfunction setDefault(obj, key, value) {\n  obj[key] = obj[key] || value\n}\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{}],4:[function(require,module,exports){\n'use strict';\r\nvar _ = require('./../plugins/utils.js');\r\n\r\n// Main Savory.js initializing config\r\nvar savoryConfig = {\r\n    container : 'container', // selector of main container\r\n    scriptsContainer : 'scripts', // id of scripts container\r\n    autoInit : true, // autoinit enabled by default\r\n    updateScrollPosition : true, // scroll to top of window on page change\r\n    links : {\r\n        external : false, // is all links are external by default?\r\n        identificatorClassName : 'external', //classname to identificate ignored link nodes\r\n        nav : {\r\n            enabled : false, // enable navigation menu behaviour. IMPORTANT: experimental feature\r\n            list : ['nav'], // list of classnames of links that should be recognized as part of one navigation menu\r\n            activeClassName : 'active' // classname of active link. This classname will be removed from other links in border of one navigation menu\r\n        }\r\n    },\r\n    error : {\r\n        containerClassname : 'savory-error' // classname of error container dom node\r\n    },\r\n    request : {\r\n        noCache : true, // disable request chaching by adding timestamp\r\n        requiredParam : true, // enable passing specified params to server on all Savory.js requests\r\n        params : { // list of params passed to server on each request\r\n            savory : true\r\n        }\r\n    },\r\n    callbacks : {} // container for Savory.js callbacks\r\n},\r\ncallbacksTypes = ['onReady','onLoad']; // types of callbacks present in Savory.js\r\n\r\n// Merge default config and user config and save it globally\r\nif (window.savoryConfig) {\r\n    window.savoryConfig = _.merge(savoryConfig, window.savoryConfig);\r\n} else {\r\n    window.savoryConfig = savoryConfig;\r\n}\r\n\r\n// Add callbacks mocks if there is no specified by user\r\nfor (var i = 0; i < callbacksTypes.length; i++) {\r\n    if (!window.savoryConfig.callbacks[callbacksTypes[i]]) {\r\n        window.savoryConfig.callbacks[callbacksTypes[i]] = function(){};\r\n    }\r\n}\r\n\r\nmodule.exports = window.savoryConfig;\n},{\"./../plugins/utils.js\":12}],5:[function(require,module,exports){\n'use strict';\r\nvar Parser = require('./../models/Parser.js'),\r\n    Loader = require('./../models/Loader.js'),\r\n    Evented = require('./../models/Evented.js'),\r\n    SavoryError = require('./../models/Error.js'),\r\n    savoryConfig = require('./../config/savory.js'),\r\n    _ = require('./../plugins/utils.js');\r\n    require('html5-history-api');\r\n    require('./../plugins/compat.js');\r\n\r\n/**\r\n * Main Savory.js controller\r\n * Initialize inner modules and create main event listeners\r\n *\r\n * @constructor\r\n */\r\nvar Interface = function(){\r\n\r\n        // Error module. Handle errors\r\n        // @see models/Error.js\r\n    var error = new SavoryError(),\r\n        // Loader module. Load data with specified options\r\n        // @see models/Loader.js\r\n        loader = new Loader(),\r\n        // Parser module. Parse loaded content\r\n        // @see models/Parser.js\r\n        parser = new Parser();\r\n\r\n    this._ = {\r\n        error : error,\r\n        loader : loader,\r\n        parser : parser,\r\n        location : window.history.location || window.location\r\n    };\r\n\r\n\r\n    Evented.global.on('page.ready', this.onPageReady.bind(this));\r\n    Evented.global.on('link.clicked', this.onLinkClick.bind(this));\r\n    Evented.global.on('page.load.success', this.onLoad.bind(this));\r\n    Evented.global.on('page.load.error', this.onError.bind(this));\r\n\r\n    Evented.on(window, 'popstate', this.onLocationChange.bind(this));\r\n\r\n    this._.loader.load();\r\n\r\n    /**\r\n     * Load content from specified path\r\n     * Part of the Savory.js public interface\r\n     *\r\n     * @param {string} path - Path of document to load\r\n     * @param {object} options - Load method options\r\n     * @param {function} options.onSuccess - Function called when content is loaded, displayed and parsed\r\n     * @param {function} options.onError - Load method options\r\n     *\r\n     * @this Interface\r\n     * @method\r\n     */\r\n    function load(/*string*/path, /*object*/options) {\r\n\r\n        if (!options || typeof options !== 'object') {\r\n            options = {};\r\n        }\r\n\r\n        options = _.merge({\r\n            onSuccess : function(){},\r\n            onError : function(){},\r\n            onScriptsLoaded : function(){}\r\n        }, options);\r\n\r\n        Evented.global.one('page.ready', options.onSuccess);\r\n        Evented.global.one('page.load.error', options.onError);\r\n        Evented.global.one('page.scripts.loaded', options.onScriptsLoaded);\r\n\r\n        loader.load(path);\r\n    }\r\n\r\n    // Public interface\r\n    this['public'] = {\r\n        load : load.bind(this)\r\n    };\r\n};\r\n\r\n/**\r\n * Method called when new page is loaded and it's content is inserted into dom\r\n * Call parser to parse new html content and fires onLoad callback\r\n *\r\n * @param {object} data - page data\r\n * @param {string} data.title - title of loaded page\r\n * @param {DOMnode} data.container - DOM node of container for parsing\r\n *\r\n * @this Interface\r\n * @method\r\n */\r\nInterface.prototype.onPageReady = function(/*obj*/data){\r\n\r\n    this._.parser.parse(data.container);\r\n    savoryConfig.callbacks.onLoad();\r\n};\r\n\r\n/**\r\n * Method called when user click on link\r\n * Path link href to onLocationChange method\r\n *\r\n * @param {object} data - page data\r\n * @param {string} data.href - path for content loading\r\n * @param {string} data.navClassName - if link node contain one of the classnames listed in config.links.nav.list, it will be here\r\n *\r\n * @this Interface\r\n * @method\r\n */\r\nInterface.prototype.onLinkClick = function(/*obj*/data){\r\n\r\n    this.onLocationChange(data.href);\r\n};\r\n\r\n/**\r\n * Method called when new page content is loaded\r\n * Hide error and push current state to History in case when this method is called not by window.popstate \r\n *\r\n * @param {object} responseData - object with response data\r\n * @param {number} data.code - response code\r\n * @param {string} data.paramString - string of GET params passed to server\r\n * @param {string} data.path - path where content was loaded from\r\n * @param {string} data.responseText - content of loaded page\r\n * @param {bool} data.silent - flag telling to push or not current state to History \r\n *\r\n * @this Interface\r\n * @method\r\n */\r\nInterface.prototype.onLoad = function(/*obj*/responseData){\r\n\r\n    this._.error.hide();\r\n\r\n    // responseData.silent is 'true' when user press \"back\" button in browser. We do not need to push this state again\r\n    if (!responseData.silent) {\r\n        history.pushState(responseData.path, null, responseData.path);        \r\n    }\r\n};\r\n\r\n/**\r\n * Method called when page loading error occurred\r\n * Hide existing error box, set new error message and show this error box.\r\n *\r\n * @param {object} responseData - object with response data\r\n * @param {number} data.code - response code\r\n * @param {string} data.paramString - string of GET params passed to server\r\n * @param {string} data.path - path where content was loaded from\r\n * @param {string} data.responseText - content of loaded page\r\n * @param {bool} data.silent - flag telling to push or not current state to History \r\n *\r\n * @this Interface\r\n * @method\r\n */\r\nInterface.prototype.onError = function(/*obj*/responseData){\r\n\r\n    this._.error.hide();\r\n    this._.error.show('Error loading ' + responseData.path + ' Error code: ' + responseData.code);\r\n};\r\n\r\n/**\r\n * Method called when location is changed before page loading\r\n * This method called by window.popstate event and by links clicks\r\n * Tells loader to load page data from specified path \r\n *\r\n * @param {string || event} href - new location href (in case when trigerred by link) or window.popstate event data\r\n *\r\n * @this Interface\r\n * @method\r\n */\r\nInterface.prototype.onLocationChange = function(/*string || event*/href) {\r\n\r\n    var silent = false;\r\n\r\n    // href is not string when window.popstate event is called\r\n    // in this case we need to pass silent:true param to loader \r\n    if (typeof href !== 'string') {\r\n        href = window.history.location.href;\r\n        silent = true;\r\n    }\r\n\r\n    this._.loader.load(href, {\r\n        silent : silent\r\n    });\r\n};\r\n\r\n/**\r\n * Remove all elements and events related to module\r\n *\r\n * @this Interface\r\n * @method\r\n */\r\nInterface.prototype.destroy = function() {\r\n    Evented.global.off('page.ready');\r\n    Evented.global.off('link.clicked');\r\n    Evented.global.off('page.load.success');\r\n    Evented.global.off('page.load.error');\r\n\r\n    Evented.off(window, 'popstate');\r\n\r\n    this._.error.destroy();\r\n    this._.loader.destroy();\r\n    this._.parser.destroy();\r\n};\r\n\r\nmodule.exports = Interface;\n},{\"./../config/savory.js\":4,\"./../models/Error.js\":6,\"./../models/Evented.js\":7,\"./../models/Loader.js\":9,\"./../models/Parser.js\":10,\"./../plugins/compat.js\":11,\"./../plugins/utils.js\":12,\"html5-history-api\":2}],6:[function(require,module,exports){\n'use strict';\r\nvar savoryConfig = require('./../config/savory.js');\r\n\r\n/**\r\n * @module Error\r\n * Main Savory.js errors class\r\n * Create error DOM node and add classnames from config\r\n * Append error container node to body\r\n *\r\n * @constructor\r\n */\r\nvar SError = function(){\r\n    this.closeTimer = null;\r\n\r\n    this.el = document.createElement('b');\r\n    this.el.classList.add(savoryConfig.error.containerClassname);\r\n    document.body.appendChild(this.el);\r\n};\r\n\r\n/**\r\n * Method for error showing\r\n * Called when there is no page at specified path\r\n * Closed automatically for 4 sec\r\n *\r\n * @param {string} message - Error message to show\r\n *\r\n * @this SError\r\n * @method\r\n */\r\nSError.prototype.show = function(/*string*/message){\r\n\r\n    if (this.closeTimer) {\r\n        clearTimeout(this.closeTimer);\r\n    }\r\n\r\n    this.el.innerHTML = message || 'Error occurred. \\\\_()_/';\r\n    this.el.setAttribute('style', 'position:fixed;z-index:999;left:0;top:0;padding:5px;background:#E44A4A;color:black;');\r\n    \r\n    this.closeTimer = setTimeout(this.hide.bind(this), 4000);\r\n};\r\n\r\n/**\r\n * Method for error hiding\r\n * Erase error container content and styles\r\n *\r\n * @this SError\r\n * @method\r\n */\r\nSError.prototype.hide = function(){\r\n    this.el.innerHTML = '';\r\n    this.el.setAttribute('style', '');\r\n};\r\n\r\n/**\r\n * Remove all elements and events related to module\r\n *\r\n * @this SError\r\n * @method\r\n */\r\nSError.prototype.destroy = function(){\r\n    if (this.closeTimer) {\r\n        clearTimeout(this.closeTimer);\r\n    }\r\n    delete this.closeTimer;\r\n    this.el.parentNode.removeChild(this.el);\r\n};\r\n\r\nmodule.exports = SError;\n},{\"./../config/savory.js\":4}],7:[function(require,module,exports){\n'use strict';\r\nvar bean = require('bean');\r\n\r\n/**\r\n * @module Evented\r\n * Include bean event lib public methods\r\n * Extend bean lib with global events via virtual dom node proxy\r\n */\r\nvar Evented = bean,\r\n    proxy = document.createElement('div'),\r\n    exposedMethods = ['on','one','off','fire'];\r\n\r\nEvented.global = {};\r\n\r\nfor (var i = exposedMethods.length - 1; i >= 0; i--) {\r\n    applyGlobalMethod(exposedMethods[i]);\r\n}\r\n\r\n/**\r\n * Expose specified bean method as global method of Evented module\r\n *\r\n * @param {string} methodName - Name of bean method needed to be exposed as global method\r\n *\r\n * @function\r\n */\r\nfunction applyGlobalMethod(/*string*/methodName){\r\n    Evented.global[methodName] = function(eventType, eventData){\r\n        bean[methodName](proxy, eventType, eventData);\r\n    };\r\n}\r\nmodule.exports = Evented;\n},{\"bean\":1}],8:[function(require,module,exports){\n'use strict';\r\nvar Evented = require('./Evented.js'),\r\n    savoryConfig = require('./../config/savory.js');\r\n\r\n/**\r\n * @module Link\r\n * Empty constructor with single method 'check'\r\n * This class is used for links validation by special criterias listed in config\r\n *\r\n * @constructor\r\n */\r\nvar Link = function(){};\r\n\r\n/**\r\n * Method for link checking\r\n * If link params fit to Savory.js config (@see config/savory.js), it's default action will be prevented\r\n * \r\n *\r\n * @param {DOMnode} link - current checked link\r\n *\r\n * @method\r\n */\r\nLink.prototype.check = function(/*DOMnode*/link){\r\n\r\n    // Experimental feature. Please use carefully\r\n    if (savoryConfig.links.nav.enabled) {\r\n\r\n        Evented.global.on('links.check', function(){\r\n            if (link.classList.contains(savoryConfig.links.nav.activeClassName)) {\r\n                link.classList.remove(savoryConfig.links.nav.activeClassName);\r\n            }\r\n        });\r\n\r\n    }    \r\n\r\n    // Prevent link re-check\r\n    if (link._savory) {\r\n        return true;\r\n    }\r\n    \r\n    var preventDefault = false,\r\n        identificatorClassName = savoryConfig.links.identificatorClassName;\r\n        \r\n    if (savoryConfig.links.external && link.classList.contains(identificatorClassName) ||\r\n        !savoryConfig.links.external && !link.classList.contains(identificatorClassName)) {\r\n        preventDefault = true;\r\n    }\r\n\r\n    if (preventDefault) {\r\n\r\n        if (link.getAttribute('href').length === 0 || link.getAttribute('href') === '#') {\r\n            return false;\r\n        }\r\n\r\n        Evented.on(link, 'click', onLinkClick);\r\n    }\r\n\r\n    link._savory = true;\r\n\r\n    function onLinkClick(event) {\r\n        var navClassName = '';\r\n\r\n        if (savoryConfig.links.nav.enabled) {\r\n\r\n            for (var i = 0; i < savoryConfig.links.nav.list.length; i++) {\r\n                \r\n                if (link.classList.contains(savoryConfig.links.nav.list[i])) {\r\n                    \r\n                    navClassName = savoryConfig.links.nav.list[i];\r\n                    \r\n                    if (this.target === '' || !this.target) {\r\n\r\n                        Evented.global.fire('links.check', {\r\n                            navClassName : navClassName\r\n                        });\r\n\r\n                        link.classList.add(savoryConfig.links.nav.activeClassName);\r\n                    }\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        Evented.global.fire('link.clicked', {\r\n            href : link.href,\r\n            navClassName : navClassName\r\n        });\r\n\r\n        if (event) {\r\n            event.preventDefault();\r\n        }\r\n\r\n        return event;\r\n    }\r\n};\r\n\r\n/**\r\n * Remove all elements and events related to module\r\n *\r\n * @this Link\r\n * @method\r\n */\r\nLink.prototype.destroy = function(link){\r\n    delete link._savory;\r\n    Evented.off(link, 'click');\r\n    Evented.on(link, 'click', function(){\r\n        return true;\r\n    });\r\n};\r\n\r\nmodule.exports = Link;\n},{\"./../config/savory.js\":4,\"./Evented.js\":7}],9:[function(require,module,exports){\n'use strict';\r\nvar Evented = require('./Evented.js'),\r\n    savoryConfig = require('./../config/savory.js'),\r\n    request = require('nanoajax'),\r\n    _ = require('./../plugins/utils.js');\r\n\r\n\r\n/**\r\n * @module Loader\r\n * Load content of new pages and execute scripts if they are on loaded page\r\n *\r\n * @constructor\r\n */\r\nvar Loader = function(){\r\n    this._url = document.createElement('a'); // overflow for url parsing\r\n    this.scripts = [];\r\n    this.currentFrameNode = null;\r\n    this._scriptsProxy = document.createElement('div');\r\n    Evented.on(this, 'page.load', this.onPageLoad.bind(this));\r\n};\r\n\r\n/**\r\n * Content loading method\r\n *\r\n * @param {string} path - Path of document to load\r\n * @param {object} loadParams - Loading params object\r\n * @param {boolean} loadParams.silent - Silent param that is proxed to page.load events\r\n *\r\n * @this Loader\r\n * @method\r\n */\r\nLoader.prototype.load = function(/*string*/path, /*object*/loadParams){\r\n    var parentContainer = document.querySelector('#'+savoryConfig.container),\r\n        paramString = '';\r\n\r\n    loadParams = _.merge({\r\n        silent : false\r\n    }, loadParams);\r\n\r\n    // if no path specified - target page is current page\r\n    if (!path) {\r\n        Evented.global.fire('page.ready', {\r\n            container : parentContainer,\r\n            title : document.title\r\n        });\r\n        return false;\r\n    }\r\n\r\n    this._url.href = path;\r\n     \r\n    /* \r\n     * Url parser examples\r\n     *\r\n     *  this._url.protocol; // => \"http:\"\r\n     *  this._url.hostname; // => \"example.com\"\r\n     *  this._url.port;     // => \"3000\"\r\n     *  this._url.pathname; // => \"/pathname/\"\r\n     *  this._url.search;   // => \"?search=test\"\r\n     *  this._url.hash;     // => \"#hash\"\r\n     *  this._url.host;     // => \"example.com:3000\"\r\n     */\r\n\r\n\r\n    /*\r\n     * Add query param properties to params object\r\n     * They will be transformed to GET query string\r\n     */\r\n    if (savoryConfig.request.requiredParam) {\r\n        for (var k in savoryConfig.request.params) {\r\n            paramString = k + '=' + savoryConfig.request.params[k];\r\n        }\r\n    }\r\n\r\n    /*\r\n     * Generate timestamp to prevent caching\r\n     */\r\n    if (savoryConfig.request.noCache) {\r\n        if (paramString.length > 0) {\r\n            paramString += '&';\r\n        }\r\n        paramString += 'ts='+ (new Date()).getTime();\r\n    }\r\n\r\n    /*\r\n     * Create GET param string\r\n     */\r\n    if (this._url.search !== '?' && paramString.length > 0) {\r\n        if (this._url.search.length > 0) {\r\n            paramString = '&' + paramString;\r\n        } else {\r\n            paramString = '?' + paramString;\r\n        }\r\n    }\r\n\r\n    /*\r\n     * Make XHR request with specified params\r\n     * \r\n     * @param {number} code - Http code of response\r\n     * @param {string} responseText - Loaded content\r\n     */\r\n    request.ajax(path + paramString, (function (/*number*/code, /*string*/responseText) {\r\n\r\n        var responseData = {\r\n            path : path,\r\n            paramString : paramString,\r\n            code : code,\r\n            responseText : responseText,\r\n            silent : loadParams.silent\r\n        };\r\n\r\n        // No errors\r\n        if (code === 200) {\r\n            Evented.global.fire('page.load.success', responseData);\r\n            this.parse(responseText);\r\n        } else {\r\n            Evented.global.fire('page.load.error', responseData);\r\n        }\r\n    }).bind(this));\r\n};\r\n\r\n/**\r\n * Method of deep html content parsing via iframe\r\n *\r\n * @param {string} html - Raw html content of loaded page\r\n *\r\n * @this Loader\r\n * @method\r\n */\r\nLoader.prototype.parse = function(/*string*/html){\r\n    // Remove script tags from raw html string\r\n    // Script will be moved to head for proper executing\r\n    var normalizedHTML = this.normalizeHTML(html),\r\n        frame = document.createElement('iframe');\r\n\r\n    frame.style.display = 'none';\r\n    document.body.appendChild(frame);\r\n\r\n    // Set private property to iframe window object to prevent Savory.js initializing in iframe \r\n    frame.contentWindow._savory = true;\r\n    \r\n    frame.onload = (function(){\r\n        this.onFrameLoad(frame, normalizedHTML.scripts);\r\n    }).bind(this);\r\n\r\n    frame.contentDocument.open();\r\n    frame.contentDocument.write(normalizedHTML.html);\r\n    frame.contentDocument.close();\r\n\r\n    this.currentFrameNode = frame;\r\n\r\n    Evented.one(this, 'frame.clear', function(){\r\n        this.currentFrameNode = null;\r\n        document.body.removeChild(frame);\r\n    });\r\n};\r\n\r\n/**\r\n * Method of deep html content parsing via iframe\r\n *\r\n * @param {DOMnode} frame - Frame DOM element\r\n * @param {string} scripts - String of non-parsed html of script tags that will be appended to head\r\n *\r\n * @this Loader\r\n * @method\r\n */\r\nLoader.prototype.onFrameLoad = function(/*DOMnode*/frame, /*string*/scripts){\r\n    var fdocument = frame.contentDocument,\r\n        container  = fdocument.querySelector('#'+savoryConfig.container),\r\n        title = fdocument.title,\r\n        comments = [],\r\n        /*\r\n         * Parse comments to get loaded document meta data (e.g. title)\r\n         * @function\r\n         */\r\n        parseComment = function(comment){\r\n            var value = comment.nodeValue;\r\n            if (value.replace('<title>','').length !== value.length) {\r\n                value = value.replace('<title>','');\r\n                value = value.replace('</title>','');\r\n                title = value;\r\n            }\r\n        };\r\n\r\n    // find and parse each comment in loaded document\r\n    if (!title) {\r\n        comments = _.findComments(fdocument);\r\n        for (var i = 0; i < comments.length; i++) {\r\n            parseComment(comments[i]);\r\n        }\r\n    }\r\n\r\n    // Trigger page.load event\r\n    // Event data will pass to onPageLoad method\r\n    Evented.fire(this, 'page.load', {\r\n        container : container,\r\n        title : title,\r\n        scripts : scripts\r\n    });\r\n};\r\n\r\n/**\r\n * Method of deep html content parsing via iframe\r\n *\r\n * @param {DOMnode} frame - Frame DOM element\r\n * @param {string} scripts - String of non-parsed html of script tags that will be appended to head\r\n *\r\n * @this Loader\r\n * @method\r\n */\r\nLoader.prototype.onPageLoad = function(/*object*/data){\r\n    var parentContainer = document.querySelector('#'+savoryConfig.container);\r\n\r\n    // Replace current container html with loaded container html    \r\n    parentContainer.outerHTML = data.container.outerHTML;\r\n\r\n    // Delete all old scripts via classname\r\n    // Remove their classnames from classnames storage called 'this.scripts'\r\n    if (this.scripts.length > 0) {\r\n\r\n        for (var i = 0; i < this.scripts.length; i++) {\r\n\r\n            deleteScripts(this.scripts[i]);\r\n\r\n            if (this.scripts.length > 1) {\r\n                this.scripts.shift();\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n    // Add new scripts\r\n    if (data.scripts) {\r\n        addScripts.call(this, data.scripts);\r\n    } else {\r\n        Evented.global.fire('page.scripts.loaded');\r\n    }\r\n\r\n    // Scroll to top of the window\r\n    if (savoryConfig.updateScrollPosition) {\r\n        window.scrollTo(0,0);\r\n    }\r\n\r\n    // Change title of document\r\n    document.title = data.title;\r\n\r\n    Evented.global.fire('page.ready', parentContainer);\r\n    Evented.fire(this, 'frame.clear');\r\n\r\n    /**\r\n     * Delete script tag from head if specified classname match\r\n     *\r\n     * @param {string} classname - Classname of script tag to remove\r\n     *\r\n     * @function\r\n     */\r\n    function deleteScripts(/*string*/classname) {\r\n        var scriptsEl = document.querySelectorAll('.savory_'+classname);\r\n\r\n        if (scriptsEl && scriptsEl.length > 0) {\r\n            for (var i = 0; i < scriptsEl.length; i++) {\r\n                deleteScript(scriptsEl[i]);\r\n            }\r\n        }\r\n\r\n        // Remove specified sript element\r\n        function deleteScript(/*DOMnode*/scriptEl){\r\n            scriptEl.parentNode.removeChild(scriptEl);\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * Create script nodes from passed raw html string which contain scripts\r\n     * Execute scripts\r\n     *\r\n     * @this Loader\r\n     * @function\r\n     */\r\n    function addScripts(/*string*/scriptsHTML){\r\n\r\n        var nodes,\r\n            scriptTags,\r\n            scriptCount = 0;\r\n\r\n        // Parse script string as html\r\n        this._scriptsProxy.innerHTML = scriptsHTML;\r\n\r\n        // Find script nodes\r\n        nodes = this._scriptsProxy.childNodes;\r\n\r\n        // Append script nodes to head for cloning\r\n        \r\n        for(i = 0; i < nodes.length; i++) {\r\n            if (nodes[i].nodeType === 1) {\r\n                document.head.appendChild(nodes[i]);\r\n            }\r\n        }\r\n\r\n        // Find newly appended scripts\r\n        scriptTags = document.head.querySelectorAll('.savory_'+this.scripts[0]);\r\n\r\n        // Clone each new script tag\r\n        for (var i = 0; i < scriptTags.length; i++) {\r\n            cloneScript(scriptTags[i]);\r\n        }\r\n\r\n        /**\r\n         * Clone script tag\r\n         * Only script that created via document.createElement and inserted to head can be executed\r\n         * Scripts will not run if you simply put their html to head \r\n         *\r\n         * @function\r\n         */\r\n        function cloneScript(/*DOMnode*/scriptTag){\r\n            var newScript = document.createElement('script'),\r\n                exec;\r\n\r\n            newScript.id = scriptTag.id || '';\r\n            newScript.className = scriptTag.className || '';\r\n\r\n            if (scriptTag.innerHTML.length > 0) {\r\n                // If script is inline - eval it's content\r\n                exec = new Function(scriptTag.innerHTML);\r\n                exec.call(window);\r\n                waitForScripts();\r\n            } else {\r\n                newScript.src = scriptTag.src || '';\r\n                newScript.onload = waitForScripts;\r\n            }\r\n\r\n\r\n            function waitForScripts(){\r\n                scriptCount++;\r\n                if (scriptCount === scriptTags.length) {\r\n                    Evented.global.fire('page.scripts.loaded');\r\n                }\r\n            }\r\n\r\n            // Remove old script and append new\r\n            document.head.appendChild(newScript);\r\n            document.head.removeChild(scriptTag);\r\n        }\r\n    }    \r\n};\r\n\r\n/**\r\n * Remove scripts tags in specified container from passed html string\r\n *\r\n * @param {string} html - String containing raw html\r\n *\r\n * @this Loader\r\n * @method\r\n */\r\nLoader.prototype.normalizeHTML = function(/*string*/html){\r\n\r\n    var template = {\r\n            start : '<div id=\"'+savoryConfig.scriptsContainer+'\">',\r\n            end : '<\\/div>'   \r\n        },\r\n        scripts = html.match(new RegExp('('+template.start+'((.|\\n|\\r)*)'+template.end+')')),\r\n        // Generate random string as script classname identificator\r\n        generateID = function(){\r\n            return Math.random().toString(36).substring(7);\r\n        };\r\n\r\n    // Remove scripts from html and save their classname ID in 'this.scripts'\r\n    if (scripts) {\r\n        var scriptsID = generateID();\r\n\r\n        html = html.split(scripts[0]);\r\n        html = html.join('');\r\n\r\n        scripts = scripts[0];\r\n        scripts = scripts.split(template.start);\r\n        scripts = scripts.join('');\r\n        scripts = scripts.split(template.end);\r\n        scripts = scripts.join('');\r\n        scripts = scripts.replace(/<( .*|)script/gi, '<script class=\"savory_'+scriptsID+'\" ');\r\n\r\n        this.scripts.push(scriptsID);\r\n    }\r\n\r\n    return {\r\n        html : html,\r\n        scripts : scripts\r\n    };\r\n};\r\n\r\n/**\r\n * Remove all elements and events related to module\r\n *\r\n * @this Loader\r\n * @method\r\n */\r\nLoader.prototype.destroy = function(){\r\n    Evented.off(this, 'page.load');\r\n    Evented.off(this, 'frame.clear');\r\n\r\n    if (this.currentFrameNode && this.currentFrameNode.parentNode) {\r\n        this.currentFrameNode.parentNode.removeChild(this.currentFrameNode);        \r\n    }\r\n};\r\n\r\nmodule.exports = Loader;\n},{\"./../config/savory.js\":4,\"./../plugins/utils.js\":12,\"./Evented.js\":7,\"nanoajax\":3}],10:[function(require,module,exports){\n'use strict';\r\nvar Link = require('./Link.js'),\r\n    Evented = require('./Evented.js'),\r\n    _ = require('./../plugins/utils.js');\r\n\r\n/**\r\n * @module Parser\r\n * Empty constructor of links parser\r\n *\r\n * @constructor\r\n */\r\nvar Parser = function(){};\r\n\r\n/**\r\n * Check every link that match criterias cpecified in config\r\n *\r\n * @method\r\n * @see models/Link\r\n */\r\nParser.prototype.parse = function(){\r\n    this.dom = {\r\n        links : new Link()\r\n    };\r\n\r\n    Evented.global.off('links.check');\r\n\r\n    _.forEach(document.links, function(i, link){\r\n        this.dom.links.check(link);\r\n    }, this);\r\n\r\n    return this.dom;\r\n};\r\n\r\n/**\r\n * Remove all elements and events related to module\r\n *\r\n * @this Parser\r\n * @method\r\n */\r\nParser.prototype.destroy = function() {\r\n\r\n    Evented.global.off('links.check');\r\n\r\n    _.forEach(document.links, function(i, link){\r\n        this.dom.links.destroy(link);\r\n    }, this);\r\n};\r\n\r\nmodule.exports = Parser;\n},{\"./../plugins/utils.js\":12,\"./Evented.js\":7,\"./Link.js\":8}],11:[function(require,module,exports){\n'use strict';\r\n\r\n// Compatibility functions\r\n// Contain classlist polyfill and bind polyfill\r\n\r\nmodule.exports = function() {\r\n    //https://github.com/remy/polyfills/blob/master/classList.js\r\n    (function () {\r\n        if (typeof window.Element === 'undefined' || 'classList' in document.documentElement) return;\r\n\r\n        var prototype = Array.prototype,\r\n            push = prototype.push,\r\n            splice = prototype.splice,\r\n            join = prototype.join;\r\n\r\n        function DOMTokenList(el) {\r\n          this.el = el;\r\n          // The className needs to be trimmed and split on whitespace\r\n          // to retrieve a list of classes.\r\n          var classes = el.className.replace(/^\\s+|\\s+$/g,'').split(/\\s+/);\r\n          for (var i = 0; i < classes.length; i++) {\r\n            push.call(this, classes[i]);\r\n          }\r\n        }\r\n\r\n        DOMTokenList.prototype = {\r\n          add: function(token) {\r\n            if(this.contains(token)) return;\r\n            push.call(this, token);\r\n            this.el.className = this.toString();\r\n          },\r\n          contains: function(token) {\r\n            return this.el.className.indexOf(token) != -1;\r\n          },\r\n          item: function(index) {\r\n            return this[index] || null;\r\n          },\r\n          remove: function(token) {\r\n            if (!this.contains(token)) return;\r\n            for (var i = 0; i < this.length; i++) {\r\n              if (this[i] == token) break;\r\n            }\r\n            splice.call(this, i, 1);\r\n            this.el.className = this.toString();\r\n          },\r\n          toString: function() {\r\n            return join.call(this, ' ');\r\n          },\r\n          toggle: function(token) {\r\n            if (!this.contains(token)) {\r\n              this.add(token);\r\n            } else {\r\n              this.remove(token);\r\n            }\r\n\r\n            return this.contains(token);\r\n          }\r\n        };\r\n\r\n        window.DOMTokenList = DOMTokenList;\r\n\r\n        function defineElementGetter (obj, prop, getter) {\r\n            if (Object.defineProperty) {\r\n                Object.defineProperty(obj, prop,{\r\n                    get : getter\r\n                });\r\n            } else {\r\n                obj.__defineGetter__(prop, getter);\r\n            }\r\n        }\r\n\r\n        defineElementGetter(Element.prototype, 'classList', function () {\r\n          return new DOMTokenList(this);\r\n        });\r\n    })();\r\n\r\n    //https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind\r\n    if (!Function.prototype.bind) {\r\n      Function.prototype.bind = function(oThis) {\r\n        if (typeof this !== 'function') {\r\n          // closest thing possible to the ECMAScript 5\r\n          // internal IsCallable function\r\n          throw new TypeError('Function.prototype.bind - what is trying to be bound is not callable');\r\n        }\r\n\r\n        var aArgs   = Array.prototype.slice.call(arguments, 1),\r\n            fToBind = this,\r\n            FNOP    = function() {},\r\n            fBound  = function() {\r\n              return fToBind.apply(this instanceof FNOP ? this : oThis,\r\n                     aArgs.concat(Array.prototype.slice.call(arguments)));\r\n            };\r\n\r\n        FNOP.prototype = this.prototype;\r\n        fBound.prototype = new FNOP();\r\n\r\n        return fBound;\r\n      };\r\n    }\r\n};\n},{}],12:[function(require,module,exports){\n'use strict';\r\n// Object with set of auxiliary methods\r\nvar utils = {\r\n    // Merge two objects \r\n    merge : function(/*object*/obj1, /*object*/obj2) {\r\n        for (var p in obj2) {\r\n            try {\r\n                // Property in destination object set; update its value.\r\n                if ( obj2[p].constructor == Object ) {\r\n                  obj1[p] = utils.merge(obj1[p], obj2[p]);\r\n                } else {\r\n                  obj1[p] = obj2[p];\r\n                }\r\n            } catch(e) {\r\n                // Property in destination object not set; create it and set its value.\r\n                obj1[p] = obj2[p];\r\n            }\r\n        }\r\n        return obj1;\r\n    },\r\n    // forEach method for arrays that execute callback to each array item\r\n    forEach : function(/*array*/array, /*function*/callback, /*obj*/scope) {\r\n        if (typeof callback !== 'function') {\r\n            return false;\r\n        }\r\n        for (var i = 0; i < array.length; i++) {\r\n            callback.call(scope, i, array[i]);\r\n        }\r\n    },\r\n    // Find comment tags in passed dom node\r\n    findComments : function(/*DOMnode*/el){\r\n        var arr = [];\r\n        for(var i = 0; i < el.childNodes.length; i++) {\r\n            var node = el.childNodes[i];\r\n            if(node.nodeType === 8) {\r\n                arr.push(node);\r\n            } else {\r\n                arr.push.apply(arr, this.findComments(node));\r\n            }\r\n        }\r\n        return arr;\r\n    }\r\n};\r\nmodule.exports = utils;\n},{}],13:[function(require,module,exports){\n'use strict';\r\n(function (root, factory) {\r\n    if (typeof exports === 'object') {\r\n        module.exports = factory();\r\n    } else if (typeof define === 'function' && define.amd) {\r\n        define(['savory'], factory);\r\n    } else {\r\n        factory();\r\n    }\r\n}(this, function () {\r\n    // load main controller\r\n    var Interface = require('./controllers/Interface.js'),\r\n        _ = require('./plugins/utils.js');\r\n\r\n    /**\r\n     * Savory constructor\r\n     * @constructor\r\n     * @param {object} config - configuration object\r\n     */\r\n    function Savory(/*obj*/config){\r\n\r\n        // prevent reinitializing\r\n        if (window._savory) {\r\n            return window._savory;\r\n        }\r\n\r\n        var config = config || {};\r\n\r\n        if (window.savoryConfig) {\r\n            config = _.merge(config, window.savoryConfig);\r\n        }\r\n\r\n        this.config = config;\r\n        this['interface'] = new Interface();\r\n\r\n        // Exposing savory public interface\r\n        this.api = this['interface']['public'];\r\n\r\n        // exec onReady callback\r\n        window.savoryConfig.callbacks.onReady(this);\r\n        // save itself data just in case\r\n        window._savory = this;\r\n    }\r\n\r\n    /**\r\n     * Remove all elements and events related to module\r\n     *\r\n     * @this Savory\r\n     * @method\r\n     */\r\n    Savory.prototype.destroy = function(){\r\n\r\n        this['interface'].destroy();\r\n\r\n        window._savory = null;\r\n        delete window._savory;\r\n        if (window.savory) {\r\n            window.savory = null;\r\n            delete window.savory;\r\n        }\r\n\r\n        return null;\r\n    };\r\n\r\n    // Expose Savory constructor\r\n    window.Savory = Savory.bind(Savory);\r\n    \r\n    // Autoinit\r\n    if (window.savoryConfig.autoInit) {\r\n        // if Savory script tag inserted in head\r\n        if (!document.body) {\r\n            window.onload = function(){\r\n                if (window.onload && typeof window.onload === 'function') {\r\n                    window.onload();                    \r\n                }\r\n                window.savory = new Savory();\r\n            }\r\n        } else { // or in bottom of body\r\n            window.savory = new Savory();\r\n        }\r\n    }\r\n\r\n    return Savory;\r\n}));\r\n\r\n\n},{\"./controllers/Interface.js\":5,\"./plugins/utils.js\":12}]},{},[13]);\n"],"sourceRoot":"/source/"}